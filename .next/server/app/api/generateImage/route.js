"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generateImage/route";
exports.ids = ["app/api/generateImage/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_ArtDocumentation_2024_ImageEcologySimulation_ecologyAPI_src_app_api_generateImage_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/generateImage/route.ts */ \"(rsc)/./src/app/api/generateImage/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generateImage/route\",\n        pathname: \"/api/generateImage\",\n        filename: \"route\",\n        bundlePath: \"app/api/generateImage/route\"\n    },\n    resolvedPagePath: \"D:\\\\ArtDocumentation\\\\2024_ImageEcologySimulation\\\\ecologyAPI\\\\src\\\\app\\\\api\\\\generateImage\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_ArtDocumentation_2024_ImageEcologySimulation_ecologyAPI_src_app_api_generateImage_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/generateImage/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZUltYWdlJTJGcm91dGUmcGFnZT0lMkZhcGklMkZnZW5lcmF0ZUltYWdlJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGZ2VuZXJhdGVJbWFnZSUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDQXJ0RG9jdW1lbnRhdGlvbiU1QzIwMjRfSW1hZ2VFY29sb2d5U2ltdWxhdGlvbiU1Q2Vjb2xvZ3lBUEklNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUQlM0ElNUNBcnREb2N1bWVudGF0aW9uJTVDMjAyNF9JbWFnZUVjb2xvZ3lTaW11bGF0aW9uJTVDZWNvbG9neUFQSSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDcUQ7QUFDbEk7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90cmVuZHMtYWktZ2VuZXJhdG9yLz9kNDQxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkQ6XFxcXEFydERvY3VtZW50YXRpb25cXFxcMjAyNF9JbWFnZUVjb2xvZ3lTaW11bGF0aW9uXFxcXGVjb2xvZ3lBUElcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcZ2VuZXJhdGVJbWFnZVxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZ2VuZXJhdGVJbWFnZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2dlbmVyYXRlSW1hZ2VcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2dlbmVyYXRlSW1hZ2Uvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJEOlxcXFxBcnREb2N1bWVudGF0aW9uXFxcXDIwMjRfSW1hZ2VFY29sb2d5U2ltdWxhdGlvblxcXFxlY29sb2d5QVBJXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGdlbmVyYXRlSW1hZ2VcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2dlbmVyYXRlSW1hZ2Uvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/generateImage/route.ts":
/*!********************************************!*\
  !*** ./src/app/api/generateImage/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime),\n/* harmony export */   uploadB64ToCloudinary: () => (/* binding */ uploadB64ToCloudinary)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var cloudinary__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! cloudinary */ \"(rsc)/./node_modules/cloudinary/cloudinary.js\");\n/* harmony import */ var cloudinary__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(cloudinary__WEBPACK_IMPORTED_MODULE_1__);\n// app/api/generateImage/route.ts\n\n\n\nconst runtime = \"nodejs\";\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\n/** Helper: safe join */ const join = (arr, sep = \", \")=>Array.isArray(arr) ? arr.filter(Boolean).map((s)=>s.trim()).join(sep) : \"\";\ncloudinary__WEBPACK_IMPORTED_MODULE_1__.v2.config({\n    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n    api_key: process.env.CLOUDINARY_API_KEY,\n    api_secret: process.env.CLOUDINARY_API_SECRET\n});\nfunction uniq(arr) {\n    return Array.from(new Set(arr.map((s)=>s.trim()).filter(Boolean)));\n}\nfunction buildAnchors(d) {\n    const objects = Array.isArray(d?.objects) ? d.objects : [];\n    const vibe = Array.isArray(d?.vibe) ? d.vibe : [];\n    const people = Array.isArray(d?.people) ? d.people : [];\n    const mustKeep = Array.isArray(d?.must_keep) ? d.must_keep : [];\n    // Anchors: explicit must_keep first, then top objects + 1 vibe + 1 person cue\n    const anchors = uniq([\n        ...mustKeep,\n        ...objects.slice(0, 5),\n        ...vibe[0] ? [\n            vibe[0]\n        ] : [],\n        ...people[0] ? [\n            people[0]\n        ] : []\n    ]).slice(0, 10);\n    return anchors;\n}\nasync function urlToFile(url, fallbackName) {\n    const res = await fetch(url);\n    if (!res.ok) throw new Error(`Failed to fetch image: ${url} (${res.status})`);\n    const contentType = res.headers.get(\"content-type\") || \"image/jpeg\";\n    const ext = contentType.includes(\"png\") ? \"png\" : contentType.includes(\"webp\") ? \"webp\" : \"jpg\";\n    const ab = await res.arrayBuffer();\n    const buf = Buffer.from(ab);\n    // Node 18+ has File/Blob\n    return new File([\n        buf\n    ], `${fallbackName}.${ext}`, {\n        type: contentType\n    });\n}\nasync function uploadB64ToCloudinary(b64) {\n    if (!b64 || typeof b64 !== \"string\") {\n        throw new Error(\"Missing base64 image\");\n    }\n    const buffer = Buffer.from(b64, \"base64\");\n    return await new Promise((resolve, reject)=>{\n        const upload = cloudinary__WEBPACK_IMPORTED_MODULE_1__.v2.uploader.upload_stream({\n            folder: \"imageEcology/placeholders\",\n            resource_type: \"image\",\n            format: \"png\",\n            transformation: [\n                {\n                    quality: \"auto\"\n                },\n                {\n                    fetch_format: \"auto\"\n                }\n            ]\n        }, (err, result)=>{\n            if (err) {\n                console.error(\"Cloudinary error:\", err);\n                return reject(err);\n            }\n            if (!result?.secure_url) {\n                console.error(\"Cloudinary returned no URL:\", result);\n                return reject(new Error(\"Cloudinary returned no secure_url\"));\n            }\n            resolve(result.secure_url);\n        });\n        upload.end(buffer);\n    });\n}\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        console.log(\"POST REQ: body\", body);\n        const { parents = [], adjectives = \"\", communities = [], trends = [], extraPrompt = \"\", size = \"1024x1024\", // ✅ new “looseness” knobs (optional from frontend)\n        remixStrength = 0.65, anchorPerParent = \"1-2\" } = body ?? {};\n        if (!Array.isArray(parents) || parents.length < 2) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Provide at least 2 parents.\"\n            }, {\n                status: 400\n            });\n        }\n        const strength = Math.max(0, Math.min(1, remixStrength));\n        // 1) Download parent images -> Files\n        const imageFiles = await Promise.all(parents.slice(0, 16).map((p, i)=>urlToFile(p.url, `parent-${i + 1}`)));\n        // 2) Build per-parent anchor summaries (high signal)\n        const parentSummaries = parents.slice(0, 16).map((p, i)=>{\n            const d = p.descriptor || {};\n            const anchors = buildAnchors(d);\n            return {\n                index: i + 1,\n                url: p.url,\n                subject: d.subject || \"\",\n                setting: d.setting || \"\",\n                medium: d.medium || \"\",\n                realism: d.realism || \"\",\n                lighting: d.lighting || \"\",\n                palette: d.palette || \"\",\n                composition: d.composition || \"\",\n                vibe: Array.isArray(d.vibe) ? d.vibe : [],\n                people: Array.isArray(d.people) ? d.people : [],\n                objects: Array.isArray(d.objects) ? d.objects : [],\n                trend: d.trend || \"\",\n                feeling: d.feeling || \"\",\n                style: d.style || \"\",\n                anchors\n            };\n        });\n        console.log(\"SUMMARIZES PARENTS\", parentSummaries);\n        // 3) Ask LLM for a *merged plan* (Structured Outputs), then render a final prompt\n        const schema = {\n            name: \"RemixPlan\",\n            strict: true,\n            schema: {\n                type: \"object\",\n                additionalProperties: false,\n                properties: {\n                    scene: {\n                        type: \"string\"\n                    },\n                    subject: {\n                        type: \"string\"\n                    },\n                    setting: {\n                        type: \"string\"\n                    },\n                    composition: {\n                        type: \"string\"\n                    },\n                    medium: {\n                        type: \"string\"\n                    },\n                    realism: {\n                        type: \"string\"\n                    },\n                    lighting: {\n                        type: \"string\"\n                    },\n                    palette: {\n                        type: \"string\"\n                    },\n                    style_notes: {\n                        type: \"string\"\n                    },\n                    must_include: {\n                        type: \"array\",\n                        items: {\n                            type: \"string\"\n                        },\n                        minItems: 4,\n                        maxItems: 16\n                    },\n                    avoid: {\n                        type: \"array\",\n                        items: {\n                            type: \"string\"\n                        },\n                        minItems: 0,\n                        maxItems: 14\n                    },\n                    // ✅ new: give the model explicit “remix permission” in output too\n                    remix_directive: {\n                        type: \"string\"\n                    }\n                },\n                required: [\n                    \"scene\",\n                    \"subject\",\n                    \"setting\",\n                    \"composition\",\n                    \"medium\",\n                    \"realism\",\n                    \"lighting\",\n                    \"palette\",\n                    \"style_notes\",\n                    \"must_include\",\n                    \"avoid\",\n                    \"remix_directive\"\n                ]\n            }\n        };\n        // ✅ NEW: creative remix rules + less rigid anchors + composition freedom\n        // We still ensure recognizability via must_include, but allow re-layout/fusion.\n        const mergePrompt = [\n            `Create ONE coherent remix plan from multiple parent images.`,\n            ``,\n            `Remix intent (critical):`,\n            `- The output should feel like a NEW image inspired by the parents, not a faithful copy.`,\n            `- You are allowed to reinterpret, resize, relocate, fuse, or stylize elements from all parents.`,\n            `- Preserve recognizability, but not exact layout, camera angle, or proportions.`,\n            `- You MAY change composition, perspective, framing, scale, and staging for higher impact.`,\n            `- Prefer surprising, meme-forward recombinations while keeping it visually coherent.`,\n            ``,\n            `Anchor rules:`,\n            `- Include at least ${anchorPerParent} recognizable anchor items from EACH parent (use parentSummaries[*].anchors).`,\n            `- Anchors can appear as props, background motifs, wardrobe details, environment cues, or fused elements.`,\n            `- Do NOT just “list” anchors; integrate them naturally into the scene.`,\n            ``,\n            `Style rules:`,\n            `- Choose ONE dominant medium + realism; harmonize lighting/palette.`,\n            `- If parents conflict, blend them into a single aesthetic (do not enumerate styles).`,\n            ``,\n            `Output constraints:`,\n            `- Unify into a single world (no grid/collage).`,\n            `- Keep it social-media-friendly and visually striking.`,\n            `- No text, no watermark, no UI.`,\n            ``,\n            `Creative looseness:`,\n            `- remixStrength=${strength} where 0=faithful edit and 1=highly remixed.`,\n            `- At higher remixStrength, push more transformation and unexpected composition shifts.`,\n            ``,\n            `Context tags:`,\n            adjectives ? `- vibe/tags: ${adjectives}` : \"\",\n            communities?.length ? `- community: ${communities.join(\", \")}` : \"\",\n            trends?.length ? `- trends: ${trends.join(\", \")}` : \"\",\n            extraPrompt ? `- extra: ${extraPrompt}` : \"\",\n            \"\",\n            `Parent summaries (anchors + style fields):`,\n            JSON.stringify(parentSummaries)\n        ].filter(Boolean).join(\"\\n\");\n        const planResp = await openai.chat.completions.create({\n            model: \"gpt-4o-mini\",\n            temperature: 0.55,\n            max_tokens: 650,\n            response_format: {\n                type: \"json_schema\",\n                json_schema: schema\n            },\n            messages: [\n                {\n                    role: \"system\",\n                    content: \"Return only JSON matching the schema. Prefer concrete visual anchors. Keep the plan remixy, not literal. Use remixStrength to decide how bold to be.\"\n                },\n                {\n                    role: \"user\",\n                    content: mergePrompt\n                }\n            ]\n        });\n        const planRaw = planResp.choices[0]?.message?.content ?? \"{}\";\n        const plan = JSON.parse(planRaw);\n        // ✅ NEW: bake in “remix permission” directly into the final prompt\n        // Also: scale the language based on remixStrength.\n        const remixLine = strength >= 0.8 ? \"Highly remixed reinterpretation with bold recomposition and surprising fusions.\" : strength >= 0.5 ? \"Creative remix reinterpretation; allow recomposition, scale shifts, and fused elements.\" : \"Light remix; small but noticeable rearrangements and stylized integrations.\";\n        const finalPrompt = [\n            // Core\n            `${plan.scene}. ${plan.subject}. ${plan.setting}.`,\n            // Remix directive (important for the image model)\n            remixLine,\n            plan.remix_directive ? plan.remix_directive : \"\",\n            // Visual control (but not too rigid)\n            `Composition: ${plan.composition}.`,\n            `Medium: ${plan.medium}, realism: ${plan.realism}.`,\n            `Lighting: ${plan.lighting}. Palette: ${plan.palette}.`,\n            plan.style_notes ? `Style: ${plan.style_notes}.` : \"\",\n            // Anchors\n            `Must include (integrated naturally): ${uniq(plan.must_include).join(\", \")}.`,\n            plan.avoid?.length ? `Avoid: ${uniq(plan.avoid).join(\", \")}.` : \"\",\n            // Universal constraints\n            `No text, no watermark, no UI, no logos, no signatures.`,\n            `Square image.`\n        ].filter(Boolean).join(\" \");\n        console.log(\"has final prompt\", finalPrompt);\n        // 4) Image remix using multi-image edits (array syntax)\n        const form = new FormData();\n        form.append(\"model\", \"gpt-image-1.5\");\n        form.append(\"prompt\", finalPrompt);\n        form.append(\"size\", size || \"1024x1024\");\n        form.append(\"output_format\", \"png\");\n        // ✅ keep multi-image, but allow a softer influence by ordering:\n        // Put the \"base\" first; others follow. (Many models implicitly bias earlier inputs.)\n        for(let i = 0; i < imageFiles.length; i++){\n            form.append(\"image[]\", imageFiles[i]);\n        }\n        const res = await fetch(\"https://api.openai.com/v1/images/edits\", {\n            method: \"POST\",\n            headers: {\n                Authorization: `Bearer ${process.env.OPENAI_API_KEY}`\n            },\n            body: form\n        });\n        if (!res.ok) {\n            const err = await res.text();\n            throw new Error(`OpenAI image edit failed: ${err}`);\n        }\n        const img = await res.json();\n        console.log(\"has image\", img);\n        const b64 = img.data?.[0]?.b64_json;\n        if (!b64) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No image returned.\"\n            }, {\n                status: 500\n            });\n        }\n        // 5) Upload remix output to Cloudinary\n        const remixUrl = await uploadB64ToCloudinary(b64);\n        console.log(\"uploaded to cloudinary temp folder\", remixUrl);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            remixedPrompt: finalPrompt,\n            plan,\n            remixStrength: strength,\n            imageUrl: remixUrl,\n            parentUrls: parents.map((p)=>p.url)\n        });\n    } catch (err) {\n        console.error(\"Remix error:\", err);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to remix images\"\n        }, {\n            status: 500\n        });\n    }\n}\n/** ---------- Existing GET (kept for compatibility) ---------- */ async function GET(request) {\n    try {\n        const url = new URL(request.url);\n        const prompt = url.searchParams.get(\"prompt\") || \"\";\n        const adjectives = url.searchParams.get(\"adjectives\") || \"\";\n        const completion = await openai.chat.completions.create({\n            model: \"gpt-3.5-turbo\",\n            messages: [\n                {\n                    role: \"user\",\n                    content: `pretend that you are an image prompt engineer that is trying to produce social media content.` + `We need to write an image prompt that expands on and depicts the following sentence: There is... ${prompt}. ` + `The image should fit this vibe: ${adjectives} and be in the style of mediaval drawings or post-internet graphics and sci-fi, ` + `please output an image prompt in english`\n                }\n            ],\n            max_tokens: 100\n        });\n        const sentence = (completion.choices[0].message.content || \"\").replace('\"', \"\");\n        const styleSuffix = \"the image should be in the style of mideaval drawings, fantasy, post-internet graphics and sci-fi. the image is not allowed to show any caption or UI element.\";\n        const image = await openai.images.generate({\n            model: \"dall-e-3\",\n            prompt: `${sentence}\\n${styleSuffix}`.trim(),\n            n: 1,\n            size: \"1024x1024\"\n        });\n        const data = {\n            prompt,\n            remixedPrompt: sentence,\n            imageUrl: image.data ? image.data[0].url : \"imageurlplaceholder\",\n            tags: adjectives\n        };\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(data);\n    } catch (error) {\n        console.error(\"Generation error (GET):\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to generate content\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9nZW5lcmF0ZUltYWdlL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEsaUNBQWlDO0FBQ1U7QUFDZjtBQUNrQjtBQUV2QyxNQUFNSSxVQUFVLFNBQVM7QUFFaEMsTUFBTUMsU0FBUyxJQUFJSiw4Q0FBTUEsQ0FBQztJQUFFSyxRQUFRQyxRQUFRQyxHQUFHLENBQUNDLGNBQWM7QUFBQztBQVMvRCxzQkFBc0IsR0FDdEIsTUFBTUMsT0FBTyxDQUFDQyxLQUF1QkMsTUFBTSxJQUFJLEdBQzdDQyxNQUFNQyxPQUFPLENBQUNILE9BQ1ZBLElBQ0dJLE1BQU0sQ0FBQ0MsU0FDUEMsR0FBRyxDQUFDLENBQUNDLElBQU1BLEVBQUVDLElBQUksSUFDakJULElBQUksQ0FBQ0UsT0FDUjtBQUVOVCwwQ0FBVUEsQ0FBQ2lCLE1BQU0sQ0FBQztJQUNoQkMsWUFBWWQsUUFBUUMsR0FBRyxDQUFDYyxxQkFBcUI7SUFDN0NDLFNBQVNoQixRQUFRQyxHQUFHLENBQUNnQixrQkFBa0I7SUFDdkNDLFlBQVlsQixRQUFRQyxHQUFHLENBQUNrQixxQkFBcUI7QUFDL0M7QUFpQ0EsU0FBU0MsS0FBS2hCLEdBQWE7SUFDekIsT0FBT0UsTUFBTWUsSUFBSSxDQUFDLElBQUlDLElBQUlsQixJQUFJTSxHQUFHLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRUMsSUFBSSxJQUFJSixNQUFNLENBQUNDO0FBQzVEO0FBRUEsU0FBU2MsYUFBYUMsQ0FBK0I7SUFDbkQsTUFBTUMsVUFBVW5CLE1BQU1DLE9BQU8sQ0FBQ2lCLEdBQUdDLFdBQVdELEVBQUdDLE9BQU8sR0FBSSxFQUFFO0lBQzVELE1BQU1DLE9BQU9wQixNQUFNQyxPQUFPLENBQUNpQixHQUFHRSxRQUFRRixFQUFHRSxJQUFJLEdBQUksRUFBRTtJQUNuRCxNQUFNQyxTQUFTckIsTUFBTUMsT0FBTyxDQUFDaUIsR0FBR0csVUFBVUgsRUFBR0csTUFBTSxHQUFJLEVBQUU7SUFDekQsTUFBTUMsV0FB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b0JBQ0VDLE1BQU07b0JBQ05DLFNBQ0UsQ0FBQyw2RkFBNkYsQ0FBQyxHQUMvRixDQUFDLGlHQUFpRyxFQUFFdUIsT0FBTyxFQUFFLENBQUMsR0FDOUcsQ0FBQyxnQ0FBZ0MsRUFBRWhGLFdBQVcsZ0ZBQWdGLENBQUMsR0FDL0gsQ0FBQyx3Q0FBd0MsQ0FBQztnQkFDOUM7YUFDRDtZQUNEb0QsWUFBWTtRQUNkO1FBRUEsTUFBTStCLFdBQVcsQ0FBQ0QsV0FBV3ZCLE9BQU8sQ0FBQyxFQUFFLENBQUNDLE9BQU8sQ0FBQ0gsT0FBTyxJQUFJLEVBQUMsRUFBRzJCLE9BQU8sQ0FDcEUsS0FDQTtRQUdGLE1BQU1DLGNBQ0o7UUFFRixNQUFNQyxRQUFRLE1BQU10SyxPQUFPdUssTUFBTSxDQUFDQyxRQUFRLENBQUM7WUFDekN0QyxPQUFPO1lBQ1A4QixRQUFRLENBQUMsRUFBRUcsU0FBUyxFQUFFLEVBQUVFLFlBQVksQ0FBQyxDQUFDdkosSUFBSTtZQUMxQzJKLEdBQUc7WUFDSHJGLE1BQU07UUFDUjtRQUVBLE1BQU1vRSxPQUFPO1lBQ1hRO1lBQ0FMLGVBQWVRO1lBQ2ZQLFVBQVVVLE1BQU1kLElBQUksR0FBR2MsTUFBTWQsSUFBSSxDQUFDLEVBQUUsQ0FBQ3JILEdBQUcsR0FBRztZQUMzQ3VJLE1BQU0xRjtRQUNSO1FBRUEsT0FBT3JGLHFEQUFZQSxDQUFDa0YsSUFBSSxDQUFDMkU7SUFDM0IsRUFBRSxPQUFPakYsT0FBTztRQUNkRCxRQUFRQyxLQUFLLENBQUMsMkJBQTJCQTtRQUN6QyxPQUFPNUUscURBQVlBLENBQUNrRixJQUFJLENBQ3RCO1lBQUVOLE9BQU87UUFBNkIsR0FDdEM7WUFBRTlCLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdHJlbmRzLWFpLWdlbmVyYXRvci8uL3NyYy9hcHAvYXBpL2dlbmVyYXRlSW1hZ2Uvcm91dGUudHM/ZWQ3ZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBhcHAvYXBpL2dlbmVyYXRlSW1hZ2Uvcm91dGUudHNcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IE9wZW5BSSBmcm9tIFwib3BlbmFpXCI7XG5pbXBvcnQgeyB2MiBhcyBjbG91ZGluYXJ5IH0gZnJvbSBcImNsb3VkaW5hcnlcIjtcblxuZXhwb3J0IGNvbnN0IHJ1bnRpbWUgPSBcIm5vZGVqc1wiO1xuXG5jb25zdCBvcGVuYWkgPSBuZXcgT3BlbkFJKHsgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSB9KTtcblxuZXhwb3J0IGludGVyZmFjZSBHZW5lcmF0aW9uUmVzdWx0IHtcbiAgc2VudGVuY2U6IHN0cmluZztcbiAgaW1hZ2VVcmw6IHN0cmluZztcbiAgdHJlbmRzOiBzdHJpbmdbXTtcbiAgZ2VvOiBzdHJpbmc7XG59XG5cbi8qKiBIZWxwZXI6IHNhZmUgam9pbiAqL1xuY29uc3Qgam9pbiA9IChhcnI/OiBzdHJpbmdbXSB8IG51bGwsIHNlcCA9IFwiLCBcIikgPT5cbiAgQXJyYXkuaXNBcnJheShhcnIpXG4gICAgPyBhcnJcbiAgICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgICAubWFwKChzKSA9PiBzLnRyaW0oKSlcbiAgICAgICAgLmpvaW4oc2VwKVxuICAgIDogXCJcIjtcblxuY2xvdWRpbmFyeS5jb25maWcoe1xuICBjbG91ZF9uYW1lOiBwcm9jZXNzLmVudi5DTE9VRElOQVJZX0NMT1VEX05BTUUsXG4gIGFwaV9rZXk6IHByb2Nlc3MuZW52LkNMT1VESU5BUllfQVBJX0tFWSxcbiAgYXBpX3NlY3JldDogcHJvY2Vzcy5lbnYuQ0xPVURJTkFSWV9BUElfU0VDUkVULFxufSk7XG5cbnR5cGUgUGFyZW50RGVzY3JpcHRvciA9IHtcbiAgLy8gTWluaW1hbFxuICB0aXRsZT86IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG5cbiAgLy8gTmV3IHN0cnVjdHVyZWQgZmllbGRzIChyZWNvbW1lbmRlZClcbiAgc3ViamVjdD86IHN0cmluZztcbiAgc2V0dGluZz86IHN0cmluZztcbiAgbWVkaXVtPzogc3RyaW5nOyAvLyBcIjNEIHJlbmRlclwiIHwgXCJwaG90b2dyYXBoXCIgfCBcImlsbHVzdHJhdGlvblwiIGV0Yy5cbiAgcmVhbGlzbT86IHN0cmluZzsgLy8gXCJwaG90b3JlYWxpc3RpY1wiIHwgXCJzdHlsaXplZFwiIGV0Yy5cbiAgbGlnaHRpbmc/OiBzdHJpbmc7XG4gIHBhbGV0dGU/OiBzdHJpbmc7XG4gIGNvbXBvc2l0aW9uPzogc3RyaW5nO1xuXG4gIC8vIEV4aXN0aW5nIGZpZWxkcyB5b3UgYWxyZWFkeSBoYXZlXG4gIHN0eWxlPzogc3RyaW5nO1xuICB2aWJlPzogc3RyaW5nW107XG4gIG9iamVjdHM/OiBzdHJpbmdbXTtcbiAgcGVvcGxlPzogc3RyaW5nW107XG4gIHRyZW5kPzogc3RyaW5nO1xuICBmZWVsaW5nPzogc3RyaW5nO1xuXG4gIC8vIEFuY2hvcnNcbiAgbXVzdF9rZWVwPzogc3RyaW5nW107IC8vIDPigJM4IGl0ZW1zIHRoYXQgc2hvdWxkIHN1cnZpdmUgdGhlIHJlbWl4XG59O1xuXG50eXBlIFJlbWl4UGFyZW50ID0ge1xuICB1cmw6IHN0cmluZzsgLy8gQ2xvdWRpbmFyeSBVUkwgb3IgYW55IHB1YmxpYyBVUkxcbiAgZGVzY3JpcHRvcj86IFBhcmVudERlc2NyaXB0b3I7XG59O1xuXG5mdW5jdGlvbiB1bmlxKGFycjogc3RyaW5nW10pIHtcbiAgcmV0dXJuIEFycmF5LmZyb20obmV3IFNldChhcnIubWFwKChzKSA9PiBzLnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pKSk7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQW5jaG9ycyhkOiBQYXJlbnREZXNjcmlwdG9yIHwgdW5kZWZpbmVkKSB7XG4gIGNvbnN0IG9iamVjdHMgPSBBcnJheS5pc0FycmF5KGQ/Lm9iamVjdHMpID8gZCEub2JqZWN0cyEgOiBbXTtcbiAgY29uc3QgdmliZSA9IEFycmF5LmlzQXJyYXkoZD8udmliZSkgPyBkIS52aWJlISA6IFtdO1xuICBjb25zdCBwZW9wbGUgPSBBcnJheS5pc0FycmF5KGQ/LnBlb3BsZSkgPyBkIS5wZW9wbGUhIDogW107XG4gIGNvbnN0IG11c3RLZWVwID0gQXJyYXkuaXNBcnJheShkPy5tdXN0X2tlZXApID8gZCEubXVzdF9rZWVwISA6IFtdO1xuXG4gIC8vIEFuY2hvcnM6IGV4cGxpY2l0IG11c3Rfa2VlcCBmaXJzdCwgdGhlbiB0b3Agb2JqZWN0cyArIDEgdmliZSArIDEgcGVyc29uIGN1ZVxuICBjb25zdCBhbmNob3JzID0gdW5pcShbXG4gICAgLi4ubXVzdEtlZXAsXG4gICAgLi4ub2JqZWN0cy5zbGljZSgwLCA1KSxcbiAgICAuLi4odmliZVswXSA/IFt2aWJlWzBdXSA6IFtdKSxcbiAgICAuLi4ocGVvcGxlWzBdID8gW3Blb3BsZVswXV0gOiBbXSksXG4gIF0pLnNsaWNlKDAsIDEwKTtcblxuICByZXR1cm4gYW5jaG9ycztcbn1cblxuYXN5bmMgZnVuY3Rpb24gdXJsVG9GaWxlKHVybDogc3RyaW5nLCBmYWxsYmFja05hbWU6IHN0cmluZyk6IFByb21pc2U8RmlsZT4ge1xuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwpO1xuICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggaW1hZ2U6ICR7dXJsfSAoJHtyZXMuc3RhdHVzfSlgKTtcblxuICBjb25zdCBjb250ZW50VHlwZSA9IHJlcy5oZWFkZXJzLmdldChcImNvbnRlbnQtdHlwZVwiKSB8fCBcImltYWdlL2pwZWdcIjtcbiAgY29uc3QgZXh0ID0gY29udGVudFR5cGUuaW5jbHVkZXMoXCJwbmdcIilcbiAgICA/IFwicG5nXCJcbiAgICA6IGNvbnRlbnRUeXBlLmluY2x1ZGVzKFwid2VicFwiKVxuICAgID8gXCJ3ZWJwXCJcbiAgICA6IFwianBnXCI7XG5cbiAgY29uc3QgYWIgPSBhd2FpdCByZXMuYXJyYXlCdWZmZXIoKTtcbiAgY29uc3QgYnVmID0gQnVmZmVyLmZyb20oYWIpO1xuXG4gIC8vIE5vZGUgMTgrIGhhcyBGaWxlL0Jsb2JcbiAgcmV0dXJuIG5ldyBGaWxlKFtidWZdLCBgJHtmYWxsYmFja05hbWV9LiR7ZXh0fWAsIHsgdHlwZTogY29udGVudFR5cGUgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGxvYWRCNjRUb0Nsb3VkaW5hcnkoYjY0OiBzdHJpbmcpIHtcbiAgaWYgKCFiNjQgfHwgdHlwZW9mIGI2NCAhPT0gXCJzdHJpbmdcIikge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgYmFzZTY0IGltYWdlXCIpO1xuICB9XG5cbiAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oYjY0LCBcImJhc2U2NFwiKTtcblxuICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgdXBsb2FkID0gY2xvdWRpbmFyeS51cGxvYWRlci51cGxvYWRfc3RyZWFtKFxuICAgICAge1xuICAgICAgICBmb2xkZXI6IFwiaW1hZ2VFY29sb2d5L3BsYWNlaG9sZGVyc1wiLFxuICAgICAgICByZXNvdXJjZV90eXBlOiBcImltYWdlXCIsXG4gICAgICAgIGZvcm1hdDogXCJwbmdcIixcbiAgICAgICAgdHJhbnNmb3JtYXRpb246IFt7IHF1YWxpdHk6IFwiYXV0b1wiIH0sIHsgZmV0Y2hfZm9ybWF0OiBcImF1dG9cIiB9XSxcbiAgICAgIH0sXG4gICAgICAoZXJyLCByZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDbG91ZGluYXJ5IGVycm9yOlwiLCBlcnIpO1xuICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghcmVzdWx0Py5zZWN1cmVfdXJsKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkNsb3VkaW5hcnkgcmV0dXJuZWQgbm8gVVJMOlwiLCByZXN1bHQpO1xuICAgICAgICAgIHJldHVybiByZWplY3QobmV3IEVycm9yKFwiQ2xvdWRpbmFyeSByZXR1cm5lZCBubyBzZWN1cmVfdXJsXCIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc29sdmUocmVzdWx0LnNlY3VyZV91cmwpO1xuICAgICAgfVxuICAgICk7XG5cbiAgICB1cGxvYWQuZW5kKGJ1ZmZlcik7XG4gIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuXG4gICAgY29uc29sZS5sb2coXCJQT1NUIFJFUTogYm9keVwiLCBib2R5KTtcblxuICAgIGNvbnN0IHtcbiAgICAgIHBhcmVudHMgPSBbXSxcbiAgICAgIGFkamVjdGl2ZXMgPSBcIlwiLFxuICAgICAgY29tbXVuaXRpZXMgPSBbXSxcbiAgICAgIHRyZW5kcyA9IFtdLFxuICAgICAgZXh0cmFQcm9tcHQgPSBcIlwiLFxuICAgICAgc2l6ZSA9IFwiMTAyNHgxMDI0XCIsXG5cbiAgICAgIC8vIOKchSBuZXcg4oCcbG9vc2VuZXNz4oCdIGtub2JzIChvcHRpb25hbCBmcm9tIGZyb250ZW5kKVxuICAgICAgcmVtaXhTdHJlbmd0aCA9IDAuNjUsIC8vIDAgKHJpZ2lkKSDihpIgMSAodmVyeSByZW1peHkpXG4gICAgICBhbmNob3JQZXJQYXJlbnQgPSBcIjEtMlwiLCAvLyBcIjEtMlwiIG9yIFwiMlwiIGV0Yy5cbiAgICB9OiB7XG4gICAgICBwYXJlbnRzOiBSZW1peFBhcmVudFtdO1xuICAgICAgYWRqZWN0aXZlcz86IHN0cmluZztcbiAgICAgIGNvbW11bml0aWVzPzogc3RyaW5nW107XG4gICAgICB0cmVuZHM/OiBzdHJpbmdbXTtcbiAgICAgIGV4dHJhUHJvbXB0Pzogc3RyaW5nO1xuICAgICAgc2l6ZT86IFwiMTAyNHgxMDI0XCIgfCBcIjE1MzZ4MTAyNFwiIHwgXCIxMDI0eDE1MzZcIiB8IFwiYXV0b1wiO1xuICAgICAgcmVtaXhTdHJlbmd0aD86IG51bWJlcjtcbiAgICAgIGFuY2hvclBlclBhcmVudD86IFwiMS0yXCIgfCBcIjJcIiB8IFwiMi0zXCI7XG4gICAgfSA9IGJvZHkgPz8ge307XG5cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkocGFyZW50cykgfHwgcGFyZW50cy5sZW5ndGggPCAyKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6IFwiUHJvdmlkZSBhdCBsZWFzdCAyIHBhcmVudHMuXCIgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHN0cmVuZ3RoID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgcmVtaXhTdHJlbmd0aCkpO1xuXG4gICAgLy8gMSkgRG93bmxvYWQgcGFyZW50IGltYWdlcyAtPiBGaWxlc1xuICAgIGNvbnN0IGltYWdlRmlsZXM6IEZpbGVbXSA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgcGFyZW50cy5zbGljZSgwLCAxNikubWFwKChwLCBpKSA9PiB1cmxUb0ZpbGUocC51cmwsIGBwYXJlbnQtJHtpICsgMX1gKSlcbiAgICApO1xuXG4gICAgLy8gMikgQnVpbGQgcGVyLXBhcmVudCBhbmNob3Igc3VtbWFyaWVzIChoaWdoIHNpZ25hbClcbiAgICBjb25zdCBwYXJlbnRTdW1tYXJpZXMgPSBwYXJlbnRzLnNsaWNlKDAsIDE2KS5tYXAoKHAsIGkpID0+IHtcbiAgICAgIGNvbnN0IGQgPSBwLmRlc2NyaXB0b3IgfHwge307XG4gICAgICBjb25zdCBhbmNob3JzID0gYnVpbGRBbmNob3JzKGQpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpbmRleDogaSArIDEsXG4gICAgICAgIHVybDogcC51cmwsXG4gICAgICAgIHN1YmplY3Q6IGQuc3ViamVjdCB8fCBcIlwiLFxuICAgICAgICBzZXR0aW5nOiBkLnNldHRpbmcgfHwgXCJcIixcbiAgICAgICAgbWVkaXVtOiBkLm1lZGl1bSB8fCBcIlwiLFxuICAgICAgICByZWFsaXNtOiBkLnJlYWxpc20gfHwgXCJcIixcbiAgICAgICAgbGlnaHRpbmc6IGQubGlnaHRpbmcgfHwgXCJcIixcbiAgICAgICAgcGFsZXR0ZTogZC5wYWxldHRlIHx8IFwiXCIsXG4gICAgICAgIGNvbXBvc2l0aW9uOiBkLmNvbXBvc2l0aW9uIHx8IFwiXCIsXG4gICAgICAgIHZpYmU6IEFycmF5LmlzQXJyYXkoZC52aWJlKSA/IGQudmliZSA6IFtdLFxuICAgICAgICBwZW9wbGU6IEFycmF5LmlzQXJyYXkoZC5wZW9wbGUpID8gZC5wZW9wbGUgOiBbXSxcbiAgICAgICAgb2JqZWN0czogQXJyYXkuaXNBcnJheShkLm9iamVjdHMpID8gZC5vYmplY3RzIDogW10sXG4gICAgICAgIHRyZW5kOiBkLnRyZW5kIHx8IFwiXCIsXG4gICAgICAgIGZlZWxpbmc6IGQuZmVlbGluZyB8fCBcIlwiLFxuICAgICAgICBzdHlsZTogZC5zdHlsZSB8fCBcIlwiLFxuICAgICAgICBhbmNob3JzLFxuICAgICAgfTtcbiAgICB9KTtcblxuICAgIGNvbnNvbGUubG9nKFwiU1VNTUFSSVpFUyBQQVJFTlRTXCIsIHBhcmVudFN1bW1hcmllcyk7XG5cbiAgICAvLyAzKSBBc2sgTExNIGZvciBhICptZXJnZWQgcGxhbiogKFN0cnVjdHVyZWQgT3V0cHV0cyksIHRoZW4gcmVuZGVyIGEgZmluYWwgcHJvbXB0XG4gICAgY29uc3Qgc2NoZW1hID0ge1xuICAgICAgbmFtZTogXCJSZW1peFBsYW5cIixcbiAgICAgIHN0cmljdDogdHJ1ZSxcbiAgICAgIHNjaGVtYToge1xuICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICBhZGRpdGlvbmFsUHJvcGVydGllczogZmFsc2UsXG4gICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICBzY2VuZTogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgc3ViamVjdDogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgc2V0dGluZzogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgY29tcG9zaXRpb246IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIG1lZGl1bTogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgcmVhbGlzbTogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgbGlnaHRpbmc6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIHBhbGV0dGU6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIHN0eWxlX25vdGVzOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICBtdXN0X2luY2x1ZGU6IHtcbiAgICAgICAgICAgIHR5cGU6IFwiYXJyYXlcIixcbiAgICAgICAgICAgIGl0ZW1zOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICAgIG1pbkl0ZW1zOiA0LFxuICAgICAgICAgICAgbWF4SXRlbXM6IDE2LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYXZvaWQ6IHtcbiAgICAgICAgICAgIHR5cGU6IFwiYXJyYXlcIixcbiAgICAgICAgICAgIGl0ZW1zOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICAgIG1pbkl0ZW1zOiAwLFxuICAgICAgICAgICAgbWF4SXRlbXM6IDE0LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8g4pyFIG5ldzogZ2l2ZSB0aGUgbW9kZWwgZXhwbGljaXQg4oCccmVtaXggcGVybWlzc2lvbuKAnSBpbiBvdXRwdXQgdG9vXG4gICAgICAgICAgcmVtaXhfZGlyZWN0aXZlOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcmVxdWlyZWQ6IFtcbiAgICAgICAgICBcInNjZW5lXCIsXG4gICAgICAgICAgXCJzdWJqZWN0XCIsXG4gICAgICAgICAgXCJzZXR0aW5nXCIsXG4gICAgICAgICAgXCJjb21wb3NpdGlvblwiLFxuICAgICAgICAgIFwibWVkaXVtXCIsXG4gICAgICAgICAgXCJyZWFsaXNtXCIsXG4gICAgICAgICAgXCJsaWdodGluZ1wiLFxuICAgICAgICAgIFwicGFsZXR0ZVwiLFxuICAgICAgICAgIFwic3R5bGVfbm90ZXNcIixcbiAgICAgICAgICBcIm11c3RfaW5jbHVkZVwiLFxuICAgICAgICAgIFwiYXZvaWRcIixcbiAgICAgICAgICBcInJlbWl4X2RpcmVjdGl2ZVwiLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICB9IGFzIGNvbnN0O1xuXG4gICAgLy8g4pyFIE5FVzogY3JlYXRpdmUgcmVtaXggcnVsZXMgKyBsZXNzIHJpZ2lkIGFuY2hvcnMgKyBjb21wb3NpdGlvbiBmcmVlZG9tXG4gICAgLy8gV2Ugc3RpbGwgZW5zdXJlIHJlY29nbml6YWJpbGl0eSB2aWEgbXVzdF9pbmNsdWRlLCBidXQgYWxsb3cgcmUtbGF5b3V0L2Z1c2lvbi5cbiAgICBjb25zdCBtZXJnZVByb21wdCA9IFtcbiAgICAgIGBDcmVhdGUgT05FIGNvaGVyZW50IHJlbWl4IHBsYW4gZnJvbSBtdWx0aXBsZSBwYXJlbnQgaW1hZ2VzLmAsXG4gICAgICBgYCxcbiAgICAgIGBSZW1peCBpbnRlbnQgKGNyaXRpY2FsKTpgLFxuICAgICAgYC0gVGhlIG91dHB1dCBzaG91bGQgZmVlbCBsaWtlIGEgTkVXIGltYWdlIGluc3BpcmVkIGJ5IHRoZSBwYXJlbnRzLCBub3QgYSBmYWl0aGZ1bCBjb3B5LmAsXG4gICAgICBgLSBZb3UgYXJlIGFsbG93ZWQgdG8gcmVpbnRlcnByZXQsIHJlc2l6ZSwgcmVsb2NhdGUsIGZ1c2UsIG9yIHN0eWxpemUgZWxlbWVudHMgZnJvbSBhbGwgcGFyZW50cy5gLFxuICAgICAgYC0gUHJlc2VydmUgcmVjb2duaXphYmlsaXR5LCBidXQgbm90IGV4YWN0IGxheW91dCwgY2FtZXJhIGFuZ2xlLCBvciBwcm9wb3J0aW9ucy5gLFxuICAgICAgYC0gWW91IE1BWSBjaGFuZ2UgY29tcG9zaXRpb24sIHBlcnNwZWN0aXZlLCBmcmFtaW5nLCBzY2FsZSwgYW5kIHN0YWdpbmcgZm9yIGhpZ2hlciBpbXBhY3QuYCxcbiAgICAgIGAtIFByZWZlciBzdXJwcmlzaW5nLCBtZW1lLWZvcndhcmQgcmVjb21iaW5hdGlvbnMgd2hpbGUga2VlcGluZyBpdCB2aXN1YWxseSBjb2hlcmVudC5gLFxuICAgICAgYGAsXG4gICAgICBgQW5jaG9yIHJ1bGVzOmAsXG4gICAgICBgLSBJbmNsdWRlIGF0IGxlYXN0ICR7YW5jaG9yUGVyUGFyZW50fSByZWNvZ25pemFibGUgYW5jaG9yIGl0ZW1zIGZyb20gRUFDSCBwYXJlbnQgKHVzZSBwYXJlbnRTdW1tYXJpZXNbKl0uYW5jaG9ycykuYCxcbiAgICAgIGAtIEFuY2hvcnMgY2FuIGFwcGVhciBhcyBwcm9wcywgYmFja2dyb3VuZCBtb3RpZnMsIHdhcmRyb2JlIGRldGFpbHMsIGVudmlyb25tZW50IGN1ZXMsIG9yIGZ1c2VkIGVsZW1lbnRzLmAsXG4gICAgICBgLSBEbyBOT1QganVzdCDigJxsaXN04oCdIGFuY2hvcnM7IGludGVncmF0ZSB0aGVtIG5hdHVyYWxseSBpbnRvIHRoZSBzY2VuZS5gLFxuICAgICAgYGAsXG4gICAgICBgU3R5bGUgcnVsZXM6YCxcbiAgICAgIGAtIENob29zZSBPTkUgZG9taW5hbnQgbWVkaXVtICsgcmVhbGlzbTsgaGFybW9uaXplIGxpZ2h0aW5nL3BhbGV0dGUuYCxcbiAgICAgIGAtIElmIHBhcmVudHMgY29uZmxpY3QsIGJsZW5kIHRoZW0gaW50byBhIHNpbmdsZSBhZXN0aGV0aWMgKGRvIG5vdCBlbnVtZXJhdGUgc3R5bGVzKS5gLFxuICAgICAgYGAsXG4gICAgICBgT3V0cHV0IGNvbnN0cmFpbnRzOmAsXG4gICAgICBgLSBVbmlmeSBpbnRvIGEgc2luZ2xlIHdvcmxkIChubyBncmlkL2NvbGxhZ2UpLmAsXG4gICAgICBgLSBLZWVwIGl0IHNvY2lhbC1tZWRpYS1mcmllbmRseSBhbmQgdmlzdWFsbHkgc3RyaWtpbmcuYCxcbiAgICAgIGAtIE5vIHRleHQsIG5vIHdhdGVybWFyaywgbm8gVUkuYCxcbiAgICAgIGBgLFxuICAgICAgYENyZWF0aXZlIGxvb3NlbmVzczpgLFxuICAgICAgYC0gcmVtaXhTdHJlbmd0aD0ke3N0cmVuZ3RofSB3aGVyZSAwPWZhaXRoZnVsIGVkaXQgYW5kIDE9aGlnaGx5IHJlbWl4ZWQuYCxcbiAgICAgIGAtIEF0IGhpZ2hlciByZW1peFN0cmVuZ3RoLCBwdXNoIG1vcmUgdHJhbnNmb3JtYXRpb24gYW5kIHVuZXhwZWN0ZWQgY29tcG9zaXRpb24gc2hpZnRzLmAsXG4gICAgICBgYCxcbiAgICAgIGBDb250ZXh0IHRhZ3M6YCxcbiAgICAgIGFkamVjdGl2ZXMgPyBgLSB2aWJlL3RhZ3M6ICR7YWRqZWN0aXZlc31gIDogXCJcIixcbiAgICAgIGNvbW11bml0aWVzPy5sZW5ndGggPyBgLSBjb21tdW5pdHk6ICR7Y29tbXVuaXRpZXMuam9pbihcIiwgXCIpfWAgOiBcIlwiLFxuICAgICAgdHJlbmRzPy5sZW5ndGggPyBgLSB0cmVuZHM6ICR7dHJlbmRzLmpvaW4oXCIsIFwiKX1gIDogXCJcIixcbiAgICAgIGV4dHJhUHJvbXB0ID8gYC0gZXh0cmE6ICR7ZXh0cmFQcm9tcHR9YCA6IFwiXCIsXG4gICAgICBcIlwiLFxuICAgICAgYFBhcmVudCBzdW1tYXJpZXMgKGFuY2hvcnMgKyBzdHlsZSBmaWVsZHMpOmAsXG4gICAgICBKU09OLnN0cmluZ2lmeShwYXJlbnRTdW1tYXJpZXMpLFxuICAgIF1cbiAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgIC5qb2luKFwiXFxuXCIpO1xuXG4gICAgY29uc3QgcGxhblJlc3AgPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgbW9kZWw6IFwiZ3B0LTRvLW1pbmlcIixcbiAgICAgIHRlbXBlcmF0dXJlOiAwLjU1LCAvLyDinIUgc2xpZ2h0bHkgaGlnaGVyIHRvIGVuY291cmFnZSBtb3JlIG5vdmVsIHJlY29tYmluYXRpb25cbiAgICAgIG1heF90b2tlbnM6IDY1MCxcbiAgICAgIHJlc3BvbnNlX2Zvcm1hdDogeyB0eXBlOiBcImpzb25fc2NoZW1hXCIsIGpzb25fc2NoZW1hOiBzY2hlbWEgfSxcbiAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiBcInN5c3RlbVwiLFxuICAgICAgICAgIGNvbnRlbnQ6XG4gICAgICAgICAgICBcIlJldHVybiBvbmx5IEpTT04gbWF0Y2hpbmcgdGhlIHNjaGVtYS4gUHJlZmVyIGNvbmNyZXRlIHZpc3VhbCBhbmNob3JzLiBLZWVwIHRoZSBwbGFuIHJlbWl4eSwgbm90IGxpdGVyYWwuIFVzZSByZW1peFN0cmVuZ3RoIHRvIGRlY2lkZSBob3cgYm9sZCB0byBiZS5cIixcbiAgICAgICAgfSxcbiAgICAgICAgeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogbWVyZ2VQcm9tcHQgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBwbGFuUmF3ID0gcGxhblJlc3AuY2hvaWNlc1swXT8ubWVzc2FnZT8uY29udGVudCA/PyBcInt9XCI7XG4gICAgY29uc3QgcGxhbiA9IEpTT04ucGFyc2UocGxhblJhdykgYXMge1xuICAgICAgc2NlbmU6IHN0cmluZztcbiAgICAgIHN1YmplY3Q6IHN0cmluZztcbiAgICAgIHNldHRpbmc6IHN0cmluZztcbiAgICAgIGNvbXBvc2l0aW9uOiBzdHJpbmc7XG4gICAgICBtZWRpdW06IHN0cmluZztcbiAgICAgIHJlYWxpc206IHN0cmluZztcbiAgICAgIGxpZ2h0aW5nOiBzdHJpbmc7XG4gICAgICBwYWxldHRlOiBzdHJpbmc7XG4gICAgICBzdHlsZV9ub3Rlczogc3RyaW5nO1xuICAgICAgbXVzdF9pbmNsdWRlOiBzdHJpbmdbXTtcbiAgICAgIGF2b2lkOiBzdHJpbmdbXTtcbiAgICAgIHJlbWl4X2RpcmVjdGl2ZTogc3RyaW5nO1xuICAgIH07XG5cbiAgICAvLyDinIUgTkVXOiBiYWtlIGluIOKAnHJlbWl4IHBlcm1pc3Npb27igJ0gZGlyZWN0bHkgaW50byB0aGUgZmluYWwgcHJvbXB0XG4gICAgLy8gQWxzbzogc2NhbGUgdGhlIGxhbmd1YWdlIGJhc2VkIG9uIHJlbWl4U3RyZW5ndGguXG4gICAgY29uc3QgcmVtaXhMaW5lID1cbiAgICAgIHN0cmVuZ3RoID49IDAuOFxuICAgICAgICA/IFwiSGlnaGx5IHJlbWl4ZWQgcmVpbnRlcnByZXRhdGlvbiB3aXRoIGJvbGQgcmVjb21wb3NpdGlvbiBhbmQgc3VycHJpc2luZyBmdXNpb25zLlwiXG4gICAgICAgIDogc3RyZW5ndGggPj0gMC41XG4gICAgICAgID8gXCJDcmVhdGl2ZSByZW1peCByZWludGVycHJldGF0aW9uOyBhbGxvdyByZWNvbXBvc2l0aW9uLCBzY2FsZSBzaGlmdHMsIGFuZCBmdXNlZCBlbGVtZW50cy5cIlxuICAgICAgICA6IFwiTGlnaHQgcmVtaXg7IHNtYWxsIGJ1dCBub3RpY2VhYmxlIHJlYXJyYW5nZW1lbnRzIGFuZCBzdHlsaXplZCBpbnRlZ3JhdGlvbnMuXCI7XG5cbiAgICBjb25zdCBmaW5hbFByb21wdCA9IFtcbiAgICAgIC8vIENvcmVcbiAgICAgIGAke3BsYW4uc2NlbmV9LiAke3BsYW4uc3ViamVjdH0uICR7cGxhbi5zZXR0aW5nfS5gLFxuICAgICAgLy8gUmVtaXggZGlyZWN0aXZlIChpbXBvcnRhbnQgZm9yIHRoZSBpbWFnZSBtb2RlbClcbiAgICAgIHJlbWl4TGluZSxcbiAgICAgIHBsYW4ucmVtaXhfZGlyZWN0aXZlID8gcGxhbi5yZW1peF9kaXJlY3RpdmUgOiBcIlwiLFxuICAgICAgLy8gVmlzdWFsIGNvbnRyb2wgKGJ1dCBub3QgdG9vIHJpZ2lkKVxuICAgICAgYENvbXBvc2l0aW9uOiAke3BsYW4uY29tcG9zaXRpb259LmAsXG4gICAgICBgTWVkaXVtOiAke3BsYW4ubWVkaXVtfSwgcmVhbGlzbTogJHtwbGFuLnJlYWxpc219LmAsXG4gICAgICBgTGlnaHRpbmc6ICR7cGxhbi5saWdodGluZ30uIFBhbGV0dGU6ICR7cGxhbi5wYWxldHRlfS5gLFxuICAgICAgcGxhbi5zdHlsZV9ub3RlcyA/IGBTdHlsZTogJHtwbGFuLnN0eWxlX25vdGVzfS5gIDogXCJcIixcbiAgICAgIC8vIEFuY2hvcnNcbiAgICAgIGBNdXN0IGluY2x1ZGUgKGludGVncmF0ZWQgbmF0dXJhbGx5KTogJHt1bmlxKHBsYW4ubXVzdF9pbmNsdWRlKS5qb2luKFxuICAgICAgICBcIiwgXCJcbiAgICAgICl9LmAsXG4gICAgICBwbGFuLmF2b2lkPy5sZW5ndGggPyBgQXZvaWQ6ICR7dW5pcShwbGFuLmF2b2lkKS5qb2luKFwiLCBcIil9LmAgOiBcIlwiLFxuICAgICAgLy8gVW5pdmVyc2FsIGNvbnN0cmFpbnRzXG4gICAgICBgTm8gdGV4dCwgbm8gd2F0ZXJtYXJrLCBubyBVSSwgbm8gbG9nb3MsIG5vIHNpZ25hdHVyZXMuYCxcbiAgICAgIGBTcXVhcmUgaW1hZ2UuYCxcbiAgICBdXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgICAuam9pbihcIiBcIik7XG5cbiAgICBjb25zb2xlLmxvZyhcImhhcyBmaW5hbCBwcm9tcHRcIiwgZmluYWxQcm9tcHQpO1xuXG4gICAgLy8gNCkgSW1hZ2UgcmVtaXggdXNpbmcgbXVsdGktaW1hZ2UgZWRpdHMgKGFycmF5IHN5bnRheClcbiAgICBjb25zdCBmb3JtID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgZm9ybS5hcHBlbmQoXCJtb2RlbFwiLCBcImdwdC1pbWFnZS0xLjVcIik7XG4gICAgZm9ybS5hcHBlbmQoXCJwcm9tcHRcIiwgZmluYWxQcm9tcHQpO1xuICAgIGZvcm0uYXBwZW5kKFwic2l6ZVwiLCBzaXplIHx8IFwiMTAyNHgxMDI0XCIpO1xuICAgIGZvcm0uYXBwZW5kKFwib3V0cHV0X2Zvcm1hdFwiLCBcInBuZ1wiKTtcblxuICAgIC8vIOKchSBrZWVwIG11bHRpLWltYWdlLCBidXQgYWxsb3cgYSBzb2Z0ZXIgaW5mbHVlbmNlIGJ5IG9yZGVyaW5nOlxuICAgIC8vIFB1dCB0aGUgXCJiYXNlXCIgZmlyc3Q7IG90aGVycyBmb2xsb3cuIChNYW55IG1vZGVscyBpbXBsaWNpdGx5IGJpYXMgZWFybGllciBpbnB1dHMuKVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW1hZ2VGaWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgZm9ybS5hcHBlbmQoXCJpbWFnZVtdXCIsIGltYWdlRmlsZXNbaV0pO1xuICAgIH1cblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKFwiaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MS9pbWFnZXMvZWRpdHNcIiwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Byb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZfWAsXG4gICAgICB9LFxuICAgICAgYm9keTogZm9ybSxcbiAgICB9KTtcblxuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCBlcnIgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBPcGVuQUkgaW1hZ2UgZWRpdCBmYWlsZWQ6ICR7ZXJyfWApO1xuICAgIH1cblxuICAgIGNvbnN0IGltZyA9IGF3YWl0IHJlcy5qc29uKCk7XG5cbiAgICBjb25zb2xlLmxvZyhcImhhcyBpbWFnZVwiLCBpbWcpO1xuXG4gICAgY29uc3QgYjY0ID0gaW1nLmRhdGE/LlswXT8uYjY0X2pzb247XG4gICAgaWYgKCFiNjQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogXCJObyBpbWFnZSByZXR1cm5lZC5cIiB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gNSkgVXBsb2FkIHJlbWl4IG91dHB1dCB0byBDbG91ZGluYXJ5XG4gICAgY29uc3QgcmVtaXhVcmwgPSBhd2FpdCB1cGxvYWRCNjRUb0Nsb3VkaW5hcnkoYjY0KTtcblxuICAgIGNvbnNvbGUubG9nKFwidXBsb2FkZWQgdG8gY2xvdWRpbmFyeSB0ZW1wIGZvbGRlclwiLCByZW1peFVybCk7XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgcmVtaXhlZFByb21wdDogZmluYWxQcm9tcHQsXG4gICAgICBwbGFuLFxuICAgICAgcmVtaXhTdHJlbmd0aDogc3RyZW5ndGgsXG4gICAgICBpbWFnZVVybDogcmVtaXhVcmwsXG4gICAgICBwYXJlbnRVcmxzOiBwYXJlbnRzLm1hcCgocCkgPT4gcC51cmwpLFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJSZW1peCBlcnJvcjpcIiwgZXJyKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiBcIkZhaWxlZCB0byByZW1peCBpbWFnZXNcIiB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuXG4vKiogLS0tLS0tLS0tLSBFeGlzdGluZyBHRVQgKGtlcHQgZm9yIGNvbXBhdGliaWxpdHkpIC0tLS0tLS0tLS0gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogUmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xuICAgIGNvbnN0IHByb21wdCA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KFwicHJvbXB0XCIpIHx8IFwiXCI7XG4gICAgY29uc3QgYWRqZWN0aXZlcyA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KFwiYWRqZWN0aXZlc1wiKSB8fCBcIlwiO1xuXG4gICAgY29uc3QgY29tcGxldGlvbiA9IGF3YWl0IG9wZW5haS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtb2RlbDogXCJncHQtMy41LXR1cmJvXCIsXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDpcbiAgICAgICAgICAgIGBwcmV0ZW5kIHRoYXQgeW91IGFyZSBhbiBpbWFnZSBwcm9tcHQgZW5naW5lZXIgdGhhdCBpcyB0cnlpbmcgdG8gcHJvZHVjZSBzb2NpYWwgbWVkaWEgY29udGVudC5gICtcbiAgICAgICAgICAgIGBXZSBuZWVkIHRvIHdyaXRlIGFuIGltYWdlIHByb21wdCB0aGF0IGV4cGFuZHMgb24gYW5kIGRlcGljdHMgdGhlIGZvbGxvd2luZyBzZW50ZW5jZTogVGhlcmUgaXMuLi4gJHtwcm9tcHR9LiBgICtcbiAgICAgICAgICAgIGBUaGUgaW1hZ2Ugc2hvdWxkIGZpdCB0aGlzIHZpYmU6ICR7YWRqZWN0aXZlc30gYW5kIGJlIGluIHRoZSBzdHlsZSBvZiBtZWRpYXZhbCBkcmF3aW5ncyBvciBwb3N0LWludGVybmV0IGdyYXBoaWNzIGFuZCBzY2ktZmksIGAgK1xuICAgICAgICAgICAgYHBsZWFzZSBvdXRwdXQgYW4gaW1hZ2UgcHJvbXB0IGluIGVuZ2xpc2hgLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIG1heF90b2tlbnM6IDEwMCxcbiAgICB9KTtcblxuICAgIGNvbnN0IHNlbnRlbmNlID0gKGNvbXBsZXRpb24uY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQgfHwgXCJcIikucmVwbGFjZShcbiAgICAgICdcIicsXG4gICAgICBcIlwiXG4gICAgKTtcblxuICAgIGNvbnN0IHN0eWxlU3VmZml4ID1cbiAgICAgIFwidGhlIGltYWdlIHNob3VsZCBiZSBpbiB0aGUgc3R5bGUgb2YgbWlkZWF2YWwgZHJhd2luZ3MsIGZhbnRhc3ksIHBvc3QtaW50ZXJuZXQgZ3JhcGhpY3MgYW5kIHNjaS1maS4gdGhlIGltYWdlIGlzIG5vdCBhbGxvd2VkIHRvIHNob3cgYW55IGNhcHRpb24gb3IgVUkgZWxlbWVudC5cIjtcblxuICAgIGNvbnN0IGltYWdlID0gYXdhaXQgb3BlbmFpLmltYWdlcy5nZW5lcmF0ZSh7XG4gICAgICBtb2RlbDogXCJkYWxsLWUtM1wiLFxuICAgICAgcHJvbXB0OiBgJHtzZW50ZW5jZX1cXG4ke3N0eWxlU3VmZml4fWAudHJpbSgpLFxuICAgICAgbjogMSxcbiAgICAgIHNpemU6IFwiMTAyNHgxMDI0XCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBkYXRhID0ge1xuICAgICAgcHJvbXB0LFxuICAgICAgcmVtaXhlZFByb21wdDogc2VudGVuY2UsXG4gICAgICBpbWFnZVVybDogaW1hZ2UuZGF0YSA/IGltYWdlLmRhdGFbMF0udXJsIDogXCJpbWFnZXVybHBsYWNlaG9sZGVyXCIsXG4gICAgICB0YWdzOiBhZGplY3RpdmVzLFxuICAgIH07XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oZGF0YSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkdlbmVyYXRpb24gZXJyb3IgKEdFVCk6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiBcIkZhaWxlZCB0byBnZW5lcmF0ZSBjb250ZW50XCIgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJPcGVuQUkiLCJ2MiIsImNsb3VkaW5hcnkiLCJydW50aW1lIiwib3BlbmFpIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwiam9pbiIsImFyciIsInNlcCIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIkJvb2xlYW4iLCJtYXAiLCJzIiwidHJpbSIsImNvbmZpZyIsImNsb3VkX25hbWUiLCJDTE9VRElOQVJZX0NMT1VEX05BTUUiLCJhcGlfa2V5IiwiQ0xPVURJTkFSWV9BUElfS0VZIiwiYXBpX3NlY3JldCIsIkNMT1VESU5BUllfQVBJX1NFQ1JFVCIsInVuaXEiLCJmcm9tIiwiU2V0IiwiYnVpbGRBbmNob3JzIiwiZCIsIm9iamVjdHMiLCJ2aWJlIiwicGVvcGxlIiwibXVzdEtlZXAiLCJtdXN0X2tlZXAiLCJhbmNob3JzIiwic2xpY2UiLCJ1cmxUb0ZpbGUiLCJ1cmwiLCJmYWxsYmFja05hbWUiLCJyZXMiLCJmZXRjaCIsIm9rIiwiRXJyb3IiLCJzdGF0dXMiLCJjb250ZW50VHlwZSIsImhlYWRlcnMiLCJnZXQiLCJleHQiLCJpbmNsdWRlcyIsImFiIiwiYXJyYXlCdWZmZXIiLCJidWYiLCJCdWZmZXIiLCJGaWxlIiwidHlwZSIsInVwbG9hZEI2NFRvQ2xvdWRpbmFyeSIsImI2NCIsImJ1ZmZlciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwidXBsb2FkIiwidXBsb2FkZXIiLCJ1cGxvYWRfc3RyZWFtIiwiZm9sZGVyIiwicmVzb3VyY2VfdHlwZSIsImZvcm1hdCIsInRyYW5zZm9ybWF0aW9uIiwicXVhbGl0eSIsImZldGNoX2Zvcm1hdCIsImVyciIsInJlc3VsdCIsImNvbnNvbGUiLCJlcnJvciIsInNlY3VyZV91cmwiLCJlbmQiLCJQT1NUIiwicmVxdWVzdCIsImJvZHkiLCJqc29uIiwibG9nIiwicGFyZW50cyIsImFkamVjdGl2ZXMiLCJjb21tdW5pdGllcyIsInRyZW5kcyIsImV4dHJhUHJvbXB0Iiwic2l6ZSIsInJlbWl4U3RyZW5ndGgiLCJhbmNob3JQZXJQYXJlbnQiLCJsZW5ndGgiLCJzdHJlbmd0aCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJpbWFnZUZpbGVzIiwiYWxsIiwicCIsImkiLCJwYXJlbnRTdW1tYXJpZXMiLCJkZXNjcmlwdG9yIiwiaW5kZXgiLCJzdWJqZWN0Iiwic2V0dGluZyIsIm1lZGl1bSIsInJlYWxpc20iLCJsaWdodGluZyIsInBhbGV0dGUiLCJjb21wb3NpdGlvbiIsInRyZW5kIiwiZmVlbGluZyIsInN0eWxlIiwic2NoZW1hIiwibmFtZSIsInN0cmljdCIsImFkZGl0aW9uYWxQcm9wZXJ0aWVzIiwicHJvcGVydGllcyIsInNjZW5lIiwic3R5bGVfbm90ZXMiLCJtdXN0X2luY2x1ZGUiLCJpdGVtcyIsIm1pbkl0ZW1zIiwibWF4SXRlbXMiLCJhdm9pZCIsInJlbWl4X2RpcmVjdGl2ZSIsInJlcXVpcmVkIiwibWVyZ2VQcm9tcHQiLCJKU09OIiwic3RyaW5naWZ5IiwicGxhblJlc3AiLCJjaGF0IiwiY29tcGxldGlvbnMiLCJjcmVhdGUiLCJtb2RlbCIsInRlbXBlcmF0dXJlIiwibWF4X3Rva2VucyIsInJlc3BvbnNlX2Zvcm1hdCIsImpzb25fc2NoZW1hIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsInBsYW5SYXciLCJjaG9pY2VzIiwibWVzc2FnZSIsInBsYW4iLCJwYXJzZSIsInJlbWl4TGluZSIsImZpbmFsUHJvbXB0IiwiZm9ybSIsIkZvcm1EYXRhIiwiYXBwZW5kIiwibWV0aG9kIiwiQXV0aG9yaXphdGlvbiIsInRleHQiLCJpbWciLCJkYXRhIiwiYjY0X2pzb24iLCJyZW1peFVybCIsInJlbWl4ZWRQcm9tcHQiLCJpbWFnZVVybCIsInBhcmVudFVybHMiLCJHRVQiLCJVUkwiLCJwcm9tcHQiLCJzZWFyY2hQYXJhbXMiLCJjb21wbGV0aW9uIiwic2VudGVuY2UiLCJyZXBsYWNlIiwic3R5bGVTdWZmaXgiLCJpbWFnZSIsImltYWdlcyIsImdlbmVyYXRlIiwibiIsInRhZ3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/generateImage/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/core-js","vendor-chunks/lodash","vendor-chunks/cloudinary","vendor-chunks/cloudinary-core","vendor-chunks/q","vendor-chunks/formdata-node","vendor-chunks/ms","vendor-chunks/openai","vendor-chunks/tr46","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/whatwg-url","vendor-chunks/event-target-shim","vendor-chunks/agentkeepalive","vendor-chunks/form-data-encoder","vendor-chunks/webidl-conversions","vendor-chunks/abort-controller","vendor-chunks/humanize-ms"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();