"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generateImage/route";
exports.ids = ["app/api/generateImage/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_ArtDocumentation_2024_ImageEcologySimulation_ecologyAPI_src_app_api_generateImage_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/generateImage/route.ts */ \"(rsc)/./src/app/api/generateImage/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generateImage/route\",\n        pathname: \"/api/generateImage\",\n        filename: \"route\",\n        bundlePath: \"app/api/generateImage/route\"\n    },\n    resolvedPagePath: \"D:\\\\ArtDocumentation\\\\2024_ImageEcologySimulation\\\\ecologyAPI\\\\src\\\\app\\\\api\\\\generateImage\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_ArtDocumentation_2024_ImageEcologySimulation_ecologyAPI_src_app_api_generateImage_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/generateImage/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZUltYWdlJTJGcm91dGUmcGFnZT0lMkZhcGklMkZnZW5lcmF0ZUltYWdlJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGZ2VuZXJhdGVJbWFnZSUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDQXJ0RG9jdW1lbnRhdGlvbiU1QzIwMjRfSW1hZ2VFY29sb2d5U2ltdWxhdGlvbiU1Q2Vjb2xvZ3lBUEklNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUQlM0ElNUNBcnREb2N1bWVudGF0aW9uJTVDMjAyNF9JbWFnZUVjb2xvZ3lTaW11bGF0aW9uJTVDZWNvbG9neUFQSSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDcUQ7QUFDbEk7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90cmVuZHMtYWktZ2VuZXJhdG9yLz9kNDQxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkQ6XFxcXEFydERvY3VtZW50YXRpb25cXFxcMjAyNF9JbWFnZUVjb2xvZ3lTaW11bGF0aW9uXFxcXGVjb2xvZ3lBUElcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcZ2VuZXJhdGVJbWFnZVxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZ2VuZXJhdGVJbWFnZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2dlbmVyYXRlSW1hZ2VcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2dlbmVyYXRlSW1hZ2Uvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJEOlxcXFxBcnREb2N1bWVudGF0aW9uXFxcXDIwMjRfSW1hZ2VFY29sb2d5U2ltdWxhdGlvblxcXFxlY29sb2d5QVBJXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGdlbmVyYXRlSW1hZ2VcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2dlbmVyYXRlSW1hZ2Uvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/generateImage/route.ts":
/*!********************************************!*\
  !*** ./src/app/api/generateImage/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var cloudinary__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! cloudinary */ \"(rsc)/./node_modules/cloudinary/cloudinary.js\");\n/* harmony import */ var cloudinary__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(cloudinary__WEBPACK_IMPORTED_MODULE_1__);\n// app/api/generateImage/route.ts\n\n\n\nconst runtime = \"nodejs\";\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\n/** Helper: safe join */ const join = (arr, sep = \", \")=>Array.isArray(arr) ? arr.filter(Boolean).map((s)=>s.trim()).join(sep) : \"\";\ncloudinary__WEBPACK_IMPORTED_MODULE_1__.v2.config({\n    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n    api_key: process.env.CLOUDINARY_API_KEY,\n    api_secret: process.env.CLOUDINARY_API_SECRET\n});\nfunction getCloudinary() {\n    cloudinary__WEBPACK_IMPORTED_MODULE_1__.v2.config({\n        cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n        api_key: process.env.CLOUDINARY_API_KEY,\n        api_secret: process.env.CLOUDINARY_API_SECRET,\n        secure: true,\n        timeout: 120000\n    });\n    return cloudinary__WEBPACK_IMPORTED_MODULE_1__.v2;\n}\nfunction uniq(arr) {\n    return Array.from(new Set(arr.map((s)=>s.trim()).filter(Boolean)));\n}\nfunction buildAnchors(d) {\n    const objects = Array.isArray(d?.objects) ? d.objects : [];\n    const vibe = Array.isArray(d?.vibe) ? d.vibe : [];\n    const people = Array.isArray(d?.people) ? d.people : [];\n    const mustKeep = Array.isArray(d?.must_keep) ? d.must_keep : [];\n    // Anchors: explicit must_keep first, then top objects + 1 vibe + 1 person cue\n    const anchors = uniq([\n        ...mustKeep,\n        ...objects.slice(0, 5),\n        ...vibe[0] ? [\n            vibe[0]\n        ] : [],\n        ...people[0] ? [\n            people[0]\n        ] : []\n    ]).slice(0, 10);\n    return anchors;\n}\nasync function urlToFile(url, fallbackName) {\n    const res = await fetch(url);\n    if (!res.ok) throw new Error(`Failed to fetch image: ${url} (${res.status})`);\n    const contentType = res.headers.get(\"content-type\") || \"image/jpeg\";\n    const ext = contentType.includes(\"png\") ? \"png\" : contentType.includes(\"webp\") ? \"webp\" : \"jpg\";\n    const ab = await res.arrayBuffer();\n    const buf = Buffer.from(ab);\n    // Node 18+ has File/Blob\n    return new File([\n        buf\n    ], `${fallbackName}.${ext}`, {\n        type: contentType\n    });\n}\nasync function uploadB64WithStream(b64, opts) {\n    const buffer = Buffer.from(b64, \"base64\");\n    return await new Promise((resolve, reject)=>{\n        const stream = cloudinary__WEBPACK_IMPORTED_MODULE_1__.v2.uploader.upload_stream({\n            folder: opts?.folder ?? \"imageEcology/placeholders\",\n            resource_type: \"image\",\n            format: \"png\",\n            context: {\n                caption: opts?.title ?? \"\",\n                alt: opts?.title ?? \"\",\n                parentIds: opts?.parentIds != null ? String(opts.parentIds) : \"\",\n                community: opts?.community ?? \"\"\n            },\n            tags: opts?.tags?.join(\",\") ?? undefined\n        }, (err, result)=>{\n            if (err) return reject(err);\n            if (!result?.secure_url) return reject(new Error(\"No secure_url from Cloudinary\"));\n            resolve(result.secure_url);\n        });\n        stream.end(buffer);\n    });\n}\nasync function uploadB64ToCloudinary(b64) {\n    if (!b64 || typeof b64 !== \"string\") {\n        throw new Error(\"Missing base64 image\");\n    }\n    const buffer = Buffer.from(b64, \"base64\");\n    const cloudinary = getCloudinary();\n    return await new Promise((resolve, reject)=>{\n        const upload = cloudinary.uploader.upload_stream({\n            folder: \"imageEcology/placeholders\",\n            resource_type: \"image\",\n            format: \"png\",\n            transformation: [\n                {\n                    quality: \"auto\"\n                },\n                {\n                    fetch_format: \"auto\"\n                }\n            ]\n        }, (err, result)=>{\n            if (err) {\n                console.error(\"Cloudinary error:\", err);\n                return reject(err);\n            }\n            if (!result?.secure_url) {\n                console.error(\"Cloudinary returned no URL:\", result);\n                return reject(new Error(\"Cloudinary returned no secure_url\"));\n            }\n            resolve(result.secure_url);\n        });\n        upload.end(buffer);\n    });\n}\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        console.log(\"POST REQ: body\", body);\n        console.log(\"CLOUDINARY_CLOUD_NAME set?\", !!process.env.CLOUDINARY_CLOUD_NAME);\n        console.log(\"CLOUDINARY_API_KEY set?\", !!process.env.CLOUDINARY_API_KEY);\n        console.log(\"CLOUDINARY_API_SECRET set?\", !!process.env.CLOUDINARY_API_SECRET);\n        const { parents = [], adjectives = \"\", communities = [], trends = [], extraPrompt = \"\", size = \"1024x1024\", // ✅ new “looseness” knobs (optional from frontend)\n        remixStrength = 0.65, anchorPerParent = \"1-2\" } = body ?? {};\n        if (!Array.isArray(parents) || parents.length < 2) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Provide at least 2 parents.\"\n            }, {\n                status: 400\n            });\n        }\n        const strength = Math.max(0, Math.min(1, remixStrength));\n        // 1) Download parent images -> Files\n        const imageFiles = await Promise.all(parents.slice(0, 16).map((p, i)=>urlToFile(p.url, `parent-${i + 1}`)));\n        // 2) Build per-parent anchor summaries (high signal)\n        const parentSummaries = parents.slice(0, 16).map((p, i)=>{\n            const d = p.descriptor || {};\n            const anchors = buildAnchors(d);\n            return {\n                index: i + 1,\n                url: p.url,\n                subject: d.subject || \"\",\n                setting: d.setting || \"\",\n                medium: d.medium || \"\",\n                realism: d.realism || \"\",\n                lighting: d.lighting || \"\",\n                palette: d.palette || \"\",\n                composition: d.composition || \"\",\n                vibe: Array.isArray(d.vibe) ? d.vibe : [],\n                people: Array.isArray(d.people) ? d.people : [],\n                objects: Array.isArray(d.objects) ? d.objects : [],\n                trend: d.trend || \"\",\n                feeling: d.feeling || \"\",\n                style: d.style || \"\",\n                anchors\n            };\n        });\n        console.log(\"SUMMARIZES PARENTS\", parentSummaries);\n        // 3) Ask LLM for a *merged plan* (Structured Outputs), then render a final prompt\n        const schema = {\n            name: \"RemixPlan\",\n            strict: true,\n            schema: {\n                type: \"object\",\n                additionalProperties: false,\n                properties: {\n                    scene: {\n                        type: \"string\"\n                    },\n                    subject: {\n                        type: \"string\"\n                    },\n                    setting: {\n                        type: \"string\"\n                    },\n                    composition: {\n                        type: \"string\"\n                    },\n                    medium: {\n                        type: \"string\"\n                    },\n                    realism: {\n                        type: \"string\"\n                    },\n                    lighting: {\n                        type: \"string\"\n                    },\n                    palette: {\n                        type: \"string\"\n                    },\n                    style_notes: {\n                        type: \"string\"\n                    },\n                    must_include: {\n                        type: \"array\",\n                        items: {\n                            type: \"string\"\n                        },\n                        minItems: 4,\n                        maxItems: 16\n                    },\n                    avoid: {\n                        type: \"array\",\n                        items: {\n                            type: \"string\"\n                        },\n                        minItems: 0,\n                        maxItems: 14\n                    },\n                    // ✅ new: give the model explicit “remix permission” in output too\n                    remix_directive: {\n                        type: \"string\"\n                    }\n                },\n                required: [\n                    \"scene\",\n                    \"subject\",\n                    \"setting\",\n                    \"composition\",\n                    \"medium\",\n                    \"realism\",\n                    \"lighting\",\n                    \"palette\",\n                    \"style_notes\",\n                    \"must_include\",\n                    \"avoid\",\n                    \"remix_directive\"\n                ]\n            }\n        };\n        // ✅ NEW: creative remix rules + less rigid anchors + composition freedom\n        // We still ensure recognizability via must_include, but allow re-layout/fusion.\n        const mergePrompt = [\n            `Create ONE coherent remix plan from multiple parent images.`,\n            ``,\n            `Remix intent (critical):`,\n            `- The output should feel like a NEW image inspired by the parents, not a faithful copy.`,\n            `- You are allowed to reinterpret, resize, relocate, fuse, or stylize elements from all parents.`,\n            `- Preserve recognizability, but not exact layout, camera angle, or proportions.`,\n            `- You MAY change composition, perspective, framing, scale, and staging for higher impact.`,\n            `- Prefer surprising, meme-forward recombinations while keeping it visually coherent.`,\n            ``,\n            `Anchor rules:`,\n            `- Include at least ${anchorPerParent} recognizable anchor items from EACH parent (use parentSummaries[*].anchors).`,\n            `- Anchors can appear as props, background motifs, wardrobe details, environment cues, or fused elements.`,\n            `- Do NOT just “list” anchors; integrate them naturally into the scene.`,\n            ``,\n            `Style rules:`,\n            `- Choose ONE dominant medium + realism; harmonize lighting/palette.`,\n            `- If parents conflict, blend them into a single aesthetic (do not enumerate styles).`,\n            ``,\n            `Output constraints:`,\n            `- Unify into a single world (no grid/collage).`,\n            `- Keep it social-media-friendly and visually striking.`,\n            `- No text, no watermark, no UI.`,\n            ``,\n            `Creative looseness:`,\n            `- remixStrength=${strength} where 0=faithful edit and 1=highly remixed.`,\n            `- At higher remixStrength, push more transformation and unexpected composition shifts.`,\n            ``,\n            `Context tags:`,\n            adjectives ? `- vibe/tags: ${adjectives}` : \"\",\n            communities?.length ? `- community: ${communities.join(\", \")}` : \"\",\n            trends?.length ? `- trends: ${trends.join(\", \")}` : \"\",\n            extraPrompt ? `- extra: ${extraPrompt}` : \"\",\n            \"\",\n            `Parent summaries (anchors + style fields):`,\n            JSON.stringify(parentSummaries)\n        ].filter(Boolean).join(\"\\n\");\n        const planResp = await openai.chat.completions.create({\n            model: \"gpt-4o-mini\",\n            temperature: 0.55,\n            max_tokens: 650,\n            response_format: {\n                type: \"json_schema\",\n                json_schema: schema\n            },\n            messages: [\n                {\n                    role: \"system\",\n                    content: \"Return only JSON matching the schema. Prefer concrete visual anchors. Keep the plan remixy, not literal. Use remixStrength to decide how bold to be.\"\n                },\n                {\n                    role: \"user\",\n                    content: mergePrompt\n                }\n            ]\n        });\n        const planRaw = planResp.choices[0]?.message?.content ?? \"{}\";\n        const plan = JSON.parse(planRaw);\n        // ✅ NEW: bake in “remix permission” directly into the final prompt\n        // Also: scale the language based on remixStrength.\n        const remixLine = strength >= 0.8 ? \"Highly remixed reinterpretation with bold recomposition and surprising fusions.\" : strength >= 0.5 ? \"Creative remix reinterpretation; allow recomposition, scale shifts, and fused elements.\" : \"Light remix; small but noticeable rearrangements and stylized integrations.\";\n        const finalPrompt = [\n            // Core\n            `${plan.scene}. ${plan.subject}. ${plan.setting}.`,\n            // Remix directive (important for the image model)\n            remixLine,\n            plan.remix_directive ? plan.remix_directive : \"\",\n            // Visual control (but not too rigid)\n            `Composition: ${plan.composition}.`,\n            `Medium: ${plan.medium}, realism: ${plan.realism}.`,\n            `Lighting: ${plan.lighting}. Palette: ${plan.palette}.`,\n            plan.style_notes ? `Style: ${plan.style_notes}.` : \"\",\n            // Anchors\n            `Must include (integrated naturally): ${uniq(plan.must_include).join(\", \")}.`,\n            plan.avoid?.length ? `Avoid: ${uniq(plan.avoid).join(\", \")}.` : \"\",\n            // Universal constraints\n            `No text, no watermark, no UI, no logos, no signatures.`,\n            `Square image.`\n        ].filter(Boolean).join(\" \");\n        console.log(\"has final prompt\", finalPrompt);\n        // 4) Image remix using multi-image edits (array syntax)\n        const form = new FormData();\n        form.append(\"model\", \"gpt-image-1.5\");\n        form.append(\"prompt\", finalPrompt);\n        form.append(\"size\", size || \"1024x1024\");\n        form.append(\"output_format\", \"jpeg\");\n        // ✅ keep multi-image, but allow a softer influence by ordering:\n        // Put the \"base\" first; others follow. (Many models implicitly bias earlier inputs.)\n        for(let i = 0; i < imageFiles.length; i++){\n            form.append(\"image[]\", imageFiles[i]);\n        }\n        const res = await fetch(\"https://api.openai.com/v1/images/edits\", {\n            method: \"POST\",\n            headers: {\n                Authorization: `Bearer ${process.env.OPENAI_API_KEY}`\n            },\n            body: form\n        });\n        if (!res.ok) {\n            const err = await res.text();\n            throw new Error(`OpenAI image edit failed: ${err}`);\n        }\n        const img = await res.json();\n        console.log(\"has image\", img);\n        const b64 = img.data?.[0]?.b64_json;\n        if (!b64) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No image returned.\"\n            }, {\n                status: 500\n            });\n        }\n        // 5) Upload remix output to Cloudinary\n        //const remixUrl = await uploadB64ToCloudinary(b64);\n        const remixUrl = await uploadB64WithStream(b64);\n        console.log(\"uploaded to cloudinary temp folder\", remixUrl);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            remixedPrompt: finalPrompt,\n            plan,\n            remixStrength: strength,\n            imageUrl: remixUrl,\n            parentUrls: parents.map((p)=>p.url)\n        });\n    } catch (err) {\n        console.error(\"Remix error:\", err);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to remix images\"\n        }, {\n            status: 500\n        });\n    }\n}\n/** ---------- Existing GET (kept for compatibility) ---------- */ async function GET(request) {\n    try {\n        const url = new URL(request.url);\n        const prompt = url.searchParams.get(\"prompt\") || \"\";\n        const adjectives = url.searchParams.get(\"adjectives\") || \"\";\n        const completion = await openai.chat.completions.create({\n            model: \"gpt-3.5-turbo\",\n            messages: [\n                {\n                    role: \"user\",\n                    content: `pretend that you are an image prompt engineer that is trying to produce social media content.` + `We need to write an image prompt that expands on and depicts the following sentence: There is... ${prompt}. ` + `The image should fit this vibe: ${adjectives} and be in the style of mediaval drawings or post-internet graphics and sci-fi, ` + `please output an image prompt in english`\n                }\n            ],\n            max_tokens: 100\n        });\n        const sentence = (completion.choices[0].message.content || \"\").replace('\"', \"\");\n        const styleSuffix = \"the image should be in the style of mideaval drawings, fantasy, post-internet graphics and sci-fi. the image is not allowed to show any caption or UI element.\";\n        const image = await openai.images.generate({\n            model: \"dall-e-3\",\n            prompt: `${sentence}\\n${styleSuffix}`.trim(),\n            n: 1,\n            size: \"1024x1024\"\n        });\n        const data = {\n            prompt,\n            remixedPrompt: sentence,\n            imageUrl: image.data ? image.data[0].url : \"imageurlplaceholder\",\n            tags: adjectives\n        };\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(data);\n    } catch (error) {\n        console.error(\"Generation error (GET):\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to generate content\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cy1haS1nZW5lcmF0b3IvLi9zcmMvYXBwL2FwaS9nZW5lcmF0ZUltYWdlL3JvdXRlLnRzP2VkN2QiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gYXBwL2FwaS9nZW5lcmF0ZUltYWdlL3JvdXRlLnRzXG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcbmltcG9ydCBPcGVuQUkgZnJvbSBcIm9wZW5haVwiO1xuaW1wb3J0IHsgdjIgYXMgY2xvdWRpbmFyeSB9IGZyb20gXCJjbG91ZGluYXJ5XCI7XG5cbmV4cG9ydCBjb25zdCBydW50aW1lID0gXCJub2RlanNcIjtcblxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7IGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkgfSk7XG5cbmV4cG9ydCBpbnRlcmZhY2UgR2VuZXJhdGlvblJlc3VsdCB7XG4gIHNlbnRlbmNlOiBzdHJpbmc7XG4gIGltYWdlVXJsOiBzdHJpbmc7XG4gIHRyZW5kczogc3RyaW5nW107XG4gIGdlbzogc3RyaW5nO1xufVxuXG4vKiogSGVscGVyOiBzYWZlIGpvaW4gKi9cbmNvbnN0IGpvaW4gPSAoYXJyPzogc3RyaW5nW10gfCBudWxsLCBzZXAgPSBcIiwgXCIpID0+XG4gIEFycmF5LmlzQXJyYXkoYXJyKVxuICAgID8gYXJyXG4gICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgICAgLm1hcCgocykgPT4gcy50cmltKCkpXG4gICAgICAgIC5qb2luKHNlcClcbiAgICA6IFwiXCI7XG5cbmNsb3VkaW5hcnkuY29uZmlnKHtcbiAgY2xvdWRfbmFtZTogcHJvY2Vzcy5lbnYuQ0xPVURJTkFSWV9DTE9VRF9OQU1FLFxuICBhcGlfa2V5OiBwcm9jZXNzLmVudi5DTE9VRElOQVJZX0FQSV9LRVksXG4gIGFwaV9zZWNyZXQ6IHByb2Nlc3MuZW52LkNMT1VESU5BUllfQVBJX1NFQ1JFVCxcbn0pO1xuXG50eXBlIFBhcmVudERlc2NyaXB0b3IgPSB7XG4gIC8vIE1pbmltYWxcbiAgdGl0bGU/OiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuXG4gIC8vIE5ldyBzdHJ1Y3R1cmVkIGZpZWxkcyAocmVjb21tZW5kZWQpXG4gIHN1YmplY3Q/OiBzdHJpbmc7XG4gIHNldHRpbmc/OiBzdHJpbmc7XG4gIG1lZGl1bT86IHN0cmluZzsgLy8gXCIzRCByZW5kZXJcIiB8IFwicGhvdG9ncmFwaFwiIHwgXCJpbGx1c3RyYXRpb25cIiBldGMuXG4gIHJlYWxpc20/OiBzdHJpbmc7IC8vIFwicGhvdG9yZWFsaXN0aWNcIiB8IFwic3R5bGl6ZWRcIiBldGMuXG4gIGxpZ2h0aW5nPzogc3RyaW5nO1xuICBwYWxldHRlPzogc3RyaW5nO1xuICBjb21wb3NpdGlvbj86IHN0cmluZztcblxuICAvLyBFeGlzdGluZyBmaWVsZHMgeW91IGFscmVhZHkgaGF2ZVxuICBzdHlsZT86IHN0cmluZztcbiAgdmliZT86IHN0cmluZ1tdO1xuICBvYmplY3RzPzogc3RyaW5nW107XG4gIHBlb3BsZT86IHN0cmluZ1tdO1xuICB0cmVuZD86IHN0cmluZztcbiAgZmVlbGluZz86IHN0cmluZztcblxuICAvLyBBbmNob3JzXG4gIG11c3Rfa2VlcD86IHN0cmluZ1tdOyAvLyAz4oCTOCBpdGVtcyB0aGF0IHNob3VsZCBzdXJ2aXZlIHRoZSByZW1peFxufTtcblxudHlwZSBSZW1peFBhcmVudCA9IHtcbiAgdXJsOiBzdHJpbmc7IC8vIENsb3VkaW5hcnkgVVJMIG9yIGFueSBwdWJsaWMgVVJMXG4gIGRlc2NyaXB0b3I/OiBQYXJlbnREZXNjcmlwdG9yO1xufTtcblxuZnVuY3Rpb24gZ2V0Q2xvdWRpbmFyeSgpIHtcbiAgY2xvdWRpbmFyeS5jb25maWcoe1xuICAgIGNsb3VkX25hbWU6IHByb2Nlc3MuZW52LkNMT1VESU5BUllfQ0xPVURfTkFNRSEsXG4gICAgYXBpX2tleTogcHJvY2Vzcy5lbnYuQ0xPVURJTkFSWV9BUElfS0VZISxcbiAgICBhcGlfc2VjcmV0OiBwcm9jZXNzLmVudi5DTE9VRElOQVJZX0FQSV9TRUNSRVQhLFxuICAgIHNlY3VyZTogdHJ1ZSxcbiAgICB0aW1lb3V0OiAxMjAwMDAsIC8vIGhlbHBzIG9uIHNsb3cgbmV0d29ya3NcbiAgfSk7XG4gIHJldHVybiBjbG91ZGluYXJ5O1xufVxuXG5mdW5jdGlvbiB1bmlxKGFycjogc3RyaW5nW10pIHtcbiAgcmV0dXJuIEFycmF5LmZyb20obmV3IFNldChhcnIubWFwKChzKSA9PiBzLnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pKSk7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQW5jaG9ycyhkOiBQYXJlbnREZXNjcmlwdG9yIHwgdW5kZWZpbmVkKSB7XG4gIGNvbnN0IG9iamVjdHMgPSBBcnJheS5pc0FycmF5KGQ/Lm9iamVjdHMpID8gZCEub2JqZWN0cyEgOiBbXTtcbiAgY29uc3QgdmliZSA9IEFycmF5LmlzQXJyYXkoZD8udmliZSkgPyBkIS52aWJlISA6IFtdO1xuICBjb25zdCBwZW9wbGUgPSBBcnJheS5pc0FycmF5KGQ/LnBlb3BsZSkgPyBkIS5wZW9wbGUhIDogW107XG4gIGNvbnN0IG11c3RLZWVwID0gQXJyYXkuaXNBcnJheShkPy5tdXN0X2tlZXApID8gZCEubXVzdF9rZWVwISA6IFtdO1xuXG4gIC8vIEFuY2hvcnM6IGV4cGxpY2l0IG11c3Rfa2VlcCBmaXJzdCwgdGhlbiB0b3Agb2JqZWN0cyArIDEgdmliZSArIDEgcGVyc29uIGN1ZVxuICBjb25zdCBhbmNob3JzID0gdW5pcShbXG4gICAgLi4ubXVzdEtlZXAsXG4gICAgLi4ub2JqZWN0cy5zbGljZSgwLCA1KSxcbiAgICAuLi4odmliZVswXSA/IFt2aWJlWzBdXSA6IFtdKSxcbiAgICAuLi4ocGVvcGxlWzBdID8gW3Blb3BsZVswXV0gOiBbXSksXG4gIF0pLnNsaWNlKDAsIDEwKTtcblxuICByZXR1cm4gYW5jaG9ycztcbn1cblxuYXN5bmMgZnVuY3Rpb24gdXJsVG9GaWxlKHVybDogc3RyaW5nLCBmYWxsYmFja05hbWU6IHN0cmluZyk6IFByb21pc2U8RmlsZT4ge1xuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwpO1xuICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggaW1hZ2U6ICR7dXJsfSAoJHtyZXMuc3RhdHVzfSlgKTtcblxuICBjb25zdCBjb250ZW50VHlwZSA9IHJlcy5oZWFkZXJzLmdldChcImNvbnRlbnQtdHlwZVwiKSB8fCBcImltYWdlL2pwZWdcIjtcbiAgY29uc3QgZXh0ID0gY29udGVudFR5cGUuaW5jbHVkZXMoXCJwbmdcIilcbiAgICA/IFwicG5nXCJcbiAgICA6IGNvbnRlbnRUeXBlLmluY2x1ZGVzKFwid2VicFwiKVxuICAgID8gXCJ3ZWJwXCJcbiAgICA6IFwianBnXCI7XG5cbiAgY29uc3QgYWIgPSBhd2FpdCByZXMuYXJyYXlCdWZmZXIoKTtcbiAgY29uc3QgYnVmID0gQnVmZmVyLmZyb20oYWIpO1xuXG4gIC8vIE5vZGUgMTgrIGhhcyBGaWxlL0Jsb2JcbiAgcmV0dXJuIG5ldyBGaWxlKFtidWZdLCBgJHtmYWxsYmFja05hbWV9LiR7ZXh0fWAsIHsgdHlwZTogY29udGVudFR5cGUgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVwbG9hZEI2NFdpdGhTdHJlYW0oXG4gIGI2NDogc3RyaW5nLFxuICBvcHRzPzoge1xuICAgIGZvbGRlcj86IHN0cmluZztcbiAgICB0aXRsZT86IHN0cmluZztcbiAgICBwYXJlbnRJZHM/OiBzdHJpbmdbXSB8IHN0cmluZztcbiAgICBjb21tdW5pdHk/OiBzdHJpbmc7XG4gICAgdGFncz86IHN0cmluZ1tdO1xuICB9XG4pIHtcbiAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oYjY0LCBcImJhc2U2NFwiKTtcblxuICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3Qgc3RyZWFtID0gY2xvdWRpbmFyeS51cGxvYWRlci51cGxvYWRfc3RyZWFtKFxuICAgICAge1xuICAgICAgICBmb2xkZXI6IG9wdHM/LmZvbGRlciA/PyBcImltYWdlRWNvbG9neS9wbGFjZWhvbGRlcnNcIixcbiAgICAgICAgcmVzb3VyY2VfdHlwZTogXCJpbWFnZVwiLFxuICAgICAgICBmb3JtYXQ6IFwicG5nXCIsXG4gICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICBjYXB0aW9uOiBvcHRzPy50aXRsZSA/PyBcIlwiLFxuICAgICAgICAgIGFsdDogb3B0cz8udGl0bGUgPz8gXCJcIixcbiAgICAgICAgICBwYXJlbnRJZHM6IG9wdHM/LnBhcmVudElkcyAhPSBudWxsID8gU3RyaW5nKG9wdHMucGFyZW50SWRzKSA6IFwiXCIsXG4gICAgICAgICAgY29tbXVuaXR5OiBvcHRzPy5jb21tdW5pdHkgPz8gXCJcIixcbiAgICAgICAgfSxcbiAgICAgICAgdGFnczogb3B0cz8udGFncz8uam9pbihcIixcIikgPz8gdW5kZWZpbmVkLFxuICAgICAgfSxcbiAgICAgIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVqZWN0KGVycik7XG4gICAgICAgIGlmICghcmVzdWx0Py5zZWN1cmVfdXJsKVxuICAgICAgICAgIHJldHVybiByZWplY3QobmV3IEVycm9yKFwiTm8gc2VjdXJlX3VybCBmcm9tIENsb3VkaW5hcnlcIikpO1xuICAgICAgICByZXNvbHZlKHJlc3VsdC5zZWN1cmVfdXJsKTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgc3RyZWFtLmVuZChidWZmZXIpO1xuICB9KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHVwbG9hZEI2NFRvQ2xvdWRpbmFyeShiNjQ6IHN0cmluZykge1xuICBpZiAoIWI2NCB8fCB0eXBlb2YgYjY0ICE9PSBcInN0cmluZ1wiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBiYXNlNjQgaW1hZ2VcIik7XG4gIH1cblxuICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShiNjQsIFwiYmFzZTY0XCIpO1xuICBjb25zdCBjbG91ZGluYXJ5ID0gZ2V0Q2xvdWRpbmFyeSgpO1xuXG4gIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCB1cGxvYWQgPSBjbG91ZGluYXJ5LnVwbG9hZGVyLnVwbG9hZF9zdHJlYW0oXG4gICAgICB7XG4gICAgICAgIGZvbGRlcjogXCJpbWFnZUVjb2xvZ3kvcGxhY2Vob2xkZXJzXCIsXG4gICAgICAgIHJlc291cmNlX3R5cGU6IFwiaW1hZ2VcIixcbiAgICAgICAgZm9ybWF0OiBcInBuZ1wiLFxuICAgICAgICB0cmFuc2Zvcm1hdGlvbjogW3sgcXVhbGl0eTogXCJhdXRvXCIgfSwgeyBmZXRjaF9mb3JtYXQ6IFwiYXV0b1wiIH1dLFxuICAgICAgfSxcbiAgICAgIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkNsb3VkaW5hcnkgZXJyb3I6XCIsIGVycik7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyZXN1bHQ/LnNlY3VyZV91cmwpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ2xvdWRpbmFyeSByZXR1cm5lZCBubyBVUkw6XCIsIHJlc3VsdCk7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChuZXcgRXJyb3IoXCJDbG91ZGluYXJ5IHJldHVybmVkIG5vIHNlY3VyZV91cmxcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVzb2x2ZShyZXN1bHQuc2VjdXJlX3VybCk7XG4gICAgICB9XG4gICAgKTtcblxuICAgIHVwbG9hZC5lbmQoYnVmZmVyKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG5cbiAgICBjb25zb2xlLmxvZyhcIlBPU1QgUkVROiBib2R5XCIsIGJvZHkpO1xuICAgIGNvbnNvbGUubG9nKFxuICAgICAgXCJDTE9VRElOQVJZX0NMT1VEX05BTUUgc2V0P1wiLFxuICAgICAgISFwcm9jZXNzLmVudi5DTE9VRElOQVJZX0NMT1VEX05BTUVcbiAgICApO1xuICAgIGNvbnNvbGUubG9nKFwiQ0xPVURJTkFSWV9BUElfS0VZIHNldD9cIiwgISFwcm9jZXNzLmVudi5DTE9VRElOQVJZX0FQSV9LRVkpO1xuICAgIGNvbnNvbGUubG9nKFxuICAgICAgXCJDTE9VRElOQVJZX0FQSV9TRUNSRVQgc2V0P1wiLFxuICAgICAgISFwcm9jZXNzLmVudi5DTE9VRElOQVJZX0FQSV9TRUNSRVRcbiAgICApO1xuXG4gICAgY29uc3Qge1xuICAgICAgcGFyZW50cyA9IFtdLFxuICAgICAgYWRqZWN0aXZlcyA9IFwiXCIsXG4gICAgICBjb21tdW5pdGllcyA9IFtdLFxuICAgICAgdHJlbmRzID0gW10sXG4gICAgICBleHRyYVByb21wdCA9IFwiXCIsXG4gICAgICBzaXplID0gXCIxMDI0eDEwMjRcIixcblxuICAgICAgLy8g4pyFIG5ldyDigJxsb29zZW5lc3PigJ0ga25vYnMgKG9wdGlvbmFsIGZyb20gZnJvbnRlbmQpXG4gICAgICByZW1peFN0cmVuZ3RoID0gMC42NSwgLy8gMCAocmlnaWQpIOKGkiAxICh2ZXJ5IHJlbWl4eSlcbiAgICAgIGFuY2hvclBlclBhcmVudCA9IFwiMS0yXCIsIC8vIFwiMS0yXCIgb3IgXCIyXCIgZXRjLlxuICAgIH06IHtcbiAgICAgIHBhcmVudHM6IFJlbWl4UGFyZW50W107XG4gICAgICBhZGplY3RpdmVzPzogc3RyaW5nO1xuICAgICAgY29tbXVuaXRpZXM/OiBzdHJpbmdbXTtcbiAgICAgIHRyZW5kcz86IHN0cmluZ1tdO1xuICAgICAgZXh0cmFQcm9tcHQ/OiBzdHJpbmc7XG4gICAgICBzaXplPzogXCIxMDI0eDEwMjRcIiB8IFwiMTUzNngxMDI0XCIgfCBcIjEwMjR4MTUzNlwiIHwgXCJhdXRvXCI7XG4gICAgICByZW1peFN0cmVuZ3RoPzogbnVtYmVyO1xuICAgICAgYW5jaG9yUGVyUGFyZW50PzogXCIxLTJcIiB8IFwiMlwiIHwgXCIyLTNcIjtcbiAgICB9ID0gYm9keSA/PyB7fTtcblxuICAgIGlmICghQXJyYXkuaXNBcnJheShwYXJlbnRzKSB8fCBwYXJlbnRzLmxlbmd0aCA8IDIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogXCJQcm92aWRlIGF0IGxlYXN0IDIgcGFyZW50cy5cIiB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RyZW5ndGggPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCByZW1peFN0cmVuZ3RoKSk7XG5cbiAgICAvLyAxKSBEb3dubG9hZCBwYXJlbnQgaW1hZ2VzIC0+IEZpbGVzXG4gICAgY29uc3QgaW1hZ2VGaWxlczogRmlsZVtdID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBwYXJlbnRzLnNsaWNlKDAsIDE2KS5tYXAoKHAsIGkpID0+IHVybFRvRmlsZShwLnVybCwgYHBhcmVudC0ke2kgKyAxfWApKVxuICAgICk7XG5cbiAgICAvLyAyKSBCdWlsZCBwZXItcGFyZW50IGFuY2hvciBzdW1tYXJpZXMgKGhpZ2ggc2lnbmFsKVxuICAgIGNvbnN0IHBhcmVudFN1bW1hcmllcyA9IHBhcmVudHMuc2xpY2UoMCwgMTYpLm1hcCgocCwgaSkgPT4ge1xuICAgICAgY29uc3QgZCA9IHAuZGVzY3JpcHRvciB8fCB7fTtcbiAgICAgIGNvbnN0IGFuY2hvcnMgPSBidWlsZEFuY2hvcnMoZCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGluZGV4OiBpICsgMSxcbiAgICAgICAgdXJsOiBwLnVybCxcbiAgICAgICAgc3ViamVjdDogZC5zdWJqZWN0IHx8IFwiXCIsXG4gICAgICAgIHNldHRpbmc6IGQuc2V0dGluZyB8fCBcIlwiLFxuICAgICAgICBtZWRpdW06IGQubWVkaXVtIHx8IFwiXCIsXG4gICAgICAgIHJlYWxpc206IGQucmVhbGlzbSB8fCBcIlwiLFxuICAgICAgICBsaWdodGluZzogZC5saWdodGluZyB8fCBcIlwiLFxuICAgICAgICBwYWxldHRlOiBkLnBhbGV0dGUgfHwgXCJcIixcbiAgICAgICAgY29tcG9zaXRpb246IGQuY29tcG9zaXRpb24gfHwgXCJcIixcbiAgICAgICAgdmliZTogQXJyYXkuaXNBcnJheShkLnZpYmUpID8gZC52aWJlIDogW10sXG4gICAgICAgIHBlb3BsZTogQXJyYXkuaXNBcnJheShkLnBlb3BsZSkgPyBkLnBlb3BsZSA6IFtdLFxuICAgICAgICBvYmplY3RzOiBBcnJheS5pc0FycmF5KGQub2JqZWN0cykgPyBkLm9iamVjdHMgOiBbXSxcbiAgICAgICAgdHJlbmQ6IGQudHJlbmQgfHwgXCJcIixcbiAgICAgICAgZmVlbGluZzogZC5mZWVsaW5nIHx8IFwiXCIsXG4gICAgICAgIHN0eWxlOiBkLnN0eWxlIHx8IFwiXCIsXG4gICAgICAgIGFuY2hvcnMsXG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgY29uc29sZS5sb2coXCJTVU1NQVJJWkVTIFBBUkVOVFNcIiwgcGFyZW50U3VtbWFyaWVzKTtcblxuICAgIC8vIDMpIEFzayBMTE0gZm9yIGEgKm1lcmdlZCBwbGFuKiAoU3RydWN0dXJlZCBPdXRwdXRzKSwgdGhlbiByZW5kZXIgYSBmaW5hbCBwcm9tcHRcbiAgICBjb25zdCBzY2hlbWEgPSB7XG4gICAgICBuYW1lOiBcIlJlbWl4UGxhblwiLFxuICAgICAgc3RyaWN0OiB0cnVlLFxuICAgICAgc2NoZW1hOiB7XG4gICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgIGFkZGl0aW9uYWxQcm9wZXJ0aWVzOiBmYWxzZSxcbiAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgIHNjZW5lOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICBzdWJqZWN0OiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICBzZXR0aW5nOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICBjb21wb3NpdGlvbjogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgbWVkaXVtOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICByZWFsaXNtOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICBsaWdodGluZzogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgcGFsZXR0ZTogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgc3R5bGVfbm90ZXM6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIG11c3RfaW5jbHVkZToge1xuICAgICAgICAgICAgdHlwZTogXCJhcnJheVwiLFxuICAgICAgICAgICAgaXRlbXM6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgICAgbWluSXRlbXM6IDQsXG4gICAgICAgICAgICBtYXhJdGVtczogMTYsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhdm9pZDoge1xuICAgICAgICAgICAgdHlwZTogXCJhcnJheVwiLFxuICAgICAgICAgICAgaXRlbXM6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgICAgbWluSXRlbXM6IDAsXG4gICAgICAgICAgICBtYXhJdGVtczogMTQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICAvLyDinIUgbmV3OiBnaXZlIHRoZSBtb2RlbCBleHBsaWNpdCDigJxyZW1peCBwZXJtaXNzaW9u4oCdIGluIG91dHB1dCB0b29cbiAgICAgICAgICByZW1peF9kaXJlY3RpdmU6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICB9LFxuICAgICAgICByZXF1aXJlZDogW1xuICAgICAgICAgIFwic2NlbmVcIixcbiAgICAgICAgICBcInN1YmplY3RcIixcbiAgICAgICAgICBcInNldHRpbmdcIixcbiAgICAgICAgICBcImNvbXBvc2l0aW9uXCIsXG4gICAgICAgICAgXCJtZWRpdW1cIixcbiAgICAgICAgICBcInJlYWxpc21cIixcbiAgICAgICAgICBcImxpZ2h0aW5nXCIsXG4gICAgICAgICAgXCJwYWxldHRlXCIsXG4gICAgICAgICAgXCJzdHlsZV9ub3Rlc1wiLFxuICAgICAgICAgIFwibXVzdF9pbmNsdWRlXCIsXG4gICAgICAgICAgXCJhdm9pZFwiLFxuICAgICAgICAgIFwicmVtaXhfZGlyZWN0aXZlXCIsXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgIH0gYXMgY29uc3Q7XG5cbiAgICAvLyDinIUgTkVXOiBjcmVhdGl2ZSByZW1peCBydWxlcyArIGxlc3MgcmlnaWQgYW5jaG9ycyArIGNvbXBvc2l0aW9uIGZyZWVkb21cbiAgICAvLyBXZSBzdGlsbCBlbnN1cmUgcmVjb2duaXphYmlsaXR5IHZpYSBtdXN0X2luY2x1ZGUsIGJ1dCBhbGxvdyByZS1sYXlvdXQvZnVzaW9uLlxuICAgIGNvbnN0IG1lcmdlUHJvbXB0ID0gW1xuICAgICAgYENyZWF0ZSBPTkUgY29oZXJlbnQgcmVtaXggcGxhbiBmcm9tIG11bHRpcGxlIHBhcmVudCBpbWFnZXMuYCxcbiAgICAgIGBgLFxuICAgICAgYFJlbWl4IGludGVudCAoY3JpdGljYWwpOmAsXG4gICAgICBgLSBUaGUgb3V0cHV0IHNob3VsZCBmZWVsIGxpa2UgYSBORVcgaW1hZ2UgaW5zcGlyZWQgYnkgdGhlIHBhcmVudHMsIG5vdCBhIGZhaXRoZnVsIGNvcHkuYCxcbiAgICAgIGAtIFlvdSBhcmUgYWxsb3dlZCB0byByZWludGVycHJldCwgcmVzaXplLCByZWxvY2F0ZSwgZnVzZSwgb3Igc3R5bGl6ZSBlbGVtZW50cyBmcm9tIGFsbCBwYXJlbnRzLmAsXG4gICAgICBgLSBQcmVzZXJ2ZSByZWNvZ25pemFiaWxpdHksIGJ1dCBub3QgZXhhY3QgbGF5b3V0LCBjYW1lcmEgYW5nbGUsIG9yIHByb3BvcnRpb25zLmAsXG4gICAgICBgLSBZb3UgTUFZIGNoYW5nZSBjb21wb3NpdGlvbiwgcGVyc3BlY3RpdmUsIGZyYW1pbmcsIHNjYWxlLCBhbmQgc3RhZ2luZyBmb3IgaGlnaGVyIGltcGFjdC5gLFxuICAgICAgYC0gUHJlZmVyIHN1cnByaXNpbmcsIG1lbWUtZm9yd2FyZCByZWNvbWJpbmF0aW9ucyB3aGlsZSBrZWVwaW5nIGl0IHZpc3VhbGx5IGNvaGVyZW50LmAsXG4gICAgICBgYCxcbiAgICAgIGBBbmNob3IgcnVsZXM6YCxcbiAgICAgIGAtIEluY2x1ZGUgYXQgbGVhc3QgJHthbmNob3JQZXJQYXJlbnR9IHJlY29nbml6YWJsZSBhbmNob3IgaXRlbXMgZnJvbSBFQUNIIHBhcmVudCAodXNlIHBhcmVudFN1bW1hcmllc1sqXS5hbmNob3JzKS5gLFxuICAgICAgYC0gQW5jaG9ycyBjYW4gYXBwZWFyIGFzIHByb3BzLCBiYWNrZ3JvdW5kIG1vdGlmcywgd2FyZHJvYmUgZGV0YWlscywgZW52aXJvbm1lbnQgY3Vlcywgb3IgZnVzZWQgZWxlbWVudHMuYCxcbiAgICAgIGAtIERvIE5PVCBqdXN0IOKAnGxpc3TigJ0gYW5jaG9yczsgaW50ZWdyYXRlIHRoZW0gbmF0dXJhbGx5IGludG8gdGhlIHNjZW5lLmAsXG4gICAgICBgYCxcbiAgICAgIGBTdHlsZSBydWxlczpgLFxuICAgICAgYC0gQ2hvb3NlIE9ORSBkb21pbmFudCBtZWRpdW0gKyByZWFsaXNtOyBoYXJtb25pemUgbGlnaHRpbmcvcGFsZXR0ZS5gLFxuICAgICAgYC0gSWYgcGFyZW50cyBjb25mbGljdCwgYmxlbmQgdGhlbSBpbnRvIGEgc2luZ2xlIGFlc3RoZXRpYyAoZG8gbm90IGVudW1lcmF0ZSBzdHlsZXMpLmAsXG4gICAgICBgYCxcbiAgICAgIGBPdXRwdXQgY29uc3RyYWludHM6YCxcbiAgICAgIGAtIFVuaWZ5IGludG8gYSBzaW5nbGUgd29ybGQgKG5vIGdyaWQvY29sbGFnZSkuYCxcbiAgICAgIGAtIEtlZXAgaXQgc29jaWFsLW1lZGlhLWZyaWVuZGx5IGFuZCB2aXN1YWxseSBzdHJpa2luZy5gLFxuICAgICAgYC0gTm8gdGV4dCwgbm8gd2F0ZXJtYXJrLCBubyBVSS5gLFxuICAgICAgYGAsXG4gICAgICBgQ3JlYXRpdmUgbG9vc2VuZXNzOmAsXG4gICAgICBgLSByZW1peFN0cmVuZ3RoPSR7c3RyZW5ndGh9IHdoZXJlIDA9ZmFpdGhmdWwgZWRpdCBhbmQgMT1oaWdobHkgcmVtaXhlZC5gLFxuICAgICAgYC0gQXQgaGlnaGVyIHJlbWl4U3RyZW5ndGgsIHB1c2ggbW9yZSB0cmFuc2Zvcm1hdGlvbiBhbmQgdW5leHBlY3RlZCBjb21wb3NpdGlvbiBzaGlmdHMuYCxcbiAgICAgIGBgLFxuICAgICAgYENvbnRleHQgdGFnczpgLFxuICAgICAgYWRqZWN0aXZlcyA/IGAtIHZpYmUvdGFnczogJHthZGplY3RpdmVzfWAgOiBcIlwiLFxuICAgICAgY29tbXVuaXRpZXM/Lmxlbmd0aCA/IGAtIGNvbW11bml0eTogJHtjb21tdW5pdGllcy5qb2luKFwiLCBcIil9YCA6IFwiXCIsXG4gICAgICB0cmVuZHM/Lmxlbmd0aCA/IGAtIHRyZW5kczogJHt0cmVuZHMuam9pbihcIiwgXCIpfWAgOiBcIlwiLFxuICAgICAgZXh0cmFQcm9tcHQgPyBgLSBleHRyYTogJHtleHRyYVByb21wdH1gIDogXCJcIixcbiAgICAgIFwiXCIsXG4gICAgICBgUGFyZW50IHN1bW1hcmllcyAoYW5jaG9ycyArIHN0eWxlIGZpZWxkcyk6YCxcbiAgICAgIEpTT04uc3RyaW5naWZ5KHBhcmVudFN1bW1hcmllcyksXG4gICAgXVxuICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgLmpvaW4oXCJcXG5cIik7XG5cbiAgICBjb25zdCBwbGFuUmVzcCA9IGF3YWl0IG9wZW5haS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtb2RlbDogXCJncHQtNG8tbWluaVwiLFxuICAgICAgdGVtcGVyYXR1cmU6IDAuNTUsIC8vIOKchSBzbGlnaHRseSBoaWdoZXIgdG8gZW5jb3VyYWdlIG1vcmUgbm92ZWwgcmVjb21iaW5hdGlvblxuICAgICAgbWF4X3Rva2VuczogNjUwLFxuICAgICAgcmVzcG9uc2VfZm9ybWF0OiB7IHR5cGU6IFwianNvbl9zY2hlbWFcIiwganNvbl9zY2hlbWE6IHNjaGVtYSB9LFxuICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwic3lzdGVtXCIsXG4gICAgICAgICAgY29udGVudDpcbiAgICAgICAgICAgIFwiUmV0dXJuIG9ubHkgSlNPTiBtYXRjaGluZyB0aGUgc2NoZW1hLiBQcmVmZXIgY29uY3JldGUgdmlzdWFsIGFuY2hvcnMuIEtlZXAgdGhlIHBsYW4gcmVtaXh5LCBub3QgbGl0ZXJhbC4gVXNlIHJlbWl4U3RyZW5ndGggdG8gZGVjaWRlIGhvdyBib2xkIHRvIGJlLlwiLFxuICAgICAgICB9LFxuICAgICAgICB7IHJvbGU6IFwidXNlclwiLCBjb250ZW50OiBtZXJnZVByb21wdCB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHBsYW5SYXcgPSBwbGFuUmVzcC5jaG9pY2VzWzBdPy5tZXNzYWdlPy5jb250ZW50ID8/IFwie31cIjtcbiAgICBjb25zdCBwbGFuID0gSlNPTi5wYXJzZShwbGFuUmF3KSBhcyB7XG4gICAgICBzY2VuZTogc3RyaW5nO1xuICAgICAgc3ViamVjdDogc3RyaW5nO1xuICAgICAgc2V0dGluZzogc3RyaW5nO1xuICAgICAgY29tcG9zaXRpb246IHN0cmluZztcbiAgICAgIG1lZGl1bTogc3RyaW5nO1xuICAgICAgcmVhbGlzbTogc3RyaW5nO1xuICAgICAgbGlnaHRpbmc6IHN0cmluZztcbiAgICAgIHBhbGV0dGU6IHN0cmluZztcbiAgICAgIHN0eWxlX25vdGVzOiBzdHJpbmc7XG4gICAgICBtdXN0X2luY2x1ZGU6IHN0cmluZ1tdO1xuICAgICAgYXZvaWQ6IHN0cmluZ1tdO1xuICAgICAgcmVtaXhfZGlyZWN0aXZlOiBzdHJpbmc7XG4gICAgfTtcblxuICAgIC8vIOKchSBORVc6IGJha2UgaW4g4oCccmVtaXggcGVybWlzc2lvbuKAnSBkaXJlY3RseSBpbnRvIHRoZSBmaW5hbCBwcm9tcHRcbiAgICAvLyBBbHNvOiBzY2FsZSB0aGUgbGFuZ3VhZ2UgYmFzZWQgb24gcmVtaXhTdHJlbmd0aC5cbiAgICBjb25zdCByZW1peExpbmUgPVxuICAgICAgc3RyZW5ndGggPj0gMC44XG4gICAgICAgID8gXCJIaWdobHkgcmVtaXhlZCByZWludGVycHJldGF0aW9uIHdpdGggYm9sZCByZWNvbXBvc2l0aW9uIGFuZCBzdXJwcmlzaW5nIGZ1c2lvbnMuXCJcbiAgICAgICAgOiBzdHJlbmd0aCA+PSAwLjVcbiAgICAgICAgPyBcIkNyZWF0aXZlIHJlbWl4IHJlaW50ZXJwcmV0YXRpb247IGFsbG93IHJlY29tcG9zaXRpb24sIHNjYWxlIHNoaWZ0cywgYW5kIGZ1c2VkIGVsZW1lbnRzLlwiXG4gICAgICAgIDogXCJMaWdodCByZW1peDsgc21hbGwgYnV0IG5vdGljZWFibGUgcmVhcnJhbmdlbWVudHMgYW5kIHN0eWxpemVkIGludGVncmF0aW9ucy5cIjtcblxuICAgIGNvbnN0IGZpbmFsUHJvbXB0ID0gW1xuICAgICAgLy8gQ29yZVxuICAgICAgYCR7cGxhbi5zY2VuZX0uICR7cGxhbi5zdWJqZWN0fS4gJHtwbGFuLnNldHRpbmd9LmAsXG4gICAgICAvLyBSZW1peCBkaXJlY3RpdmUgKGltcG9ydGFudCBmb3IgdGhlIGltYWdlIG1vZGVsKVxuICAgICAgcmVtaXhMaW5lLFxuICAgICAgcGxhbi5yZW1peF9kaXJlY3RpdmUgPyBwbGFuLnJlbWl4X2RpcmVjdGl2ZSA6IFwiXCIsXG4gICAgICAvLyBWaXN1YWwgY29udHJvbCAoYnV0IG5vdCB0b28gcmlnaWQpXG4gICAgICBgQ29tcG9zaXRpb246ICR7cGxhbi5jb21wb3NpdGlvbn0uYCxcbiAgICAgIGBNZWRpdW06ICR7cGxhbi5tZWRpdW19LCByZWFsaXNtOiAke3BsYW4ucmVhbGlzbX0uYCxcbiAgICAgIGBMaWdodGluZzogJHtwbGFuLmxpZ2h0aW5nfS4gUGFsZXR0ZTogJHtwbGFuLnBhbGV0dGV9LmAsXG4gICAgICBwbGFuLnN0eWxlX25vdGVzID8gYFN0eWxlOiAke3BsYW4uc3R5bGVfbm90ZXN9LmAgOiBcIlwiLFxuICAgICAgLy8gQW5jaG9yc1xuICAgICAgYE11c3QgaW5jbHVkZSAoaW50ZWdyYXRlZCBuYXR1cmFsbHkpOiAke3VuaXEocGxhbi5tdXN0X2luY2x1ZGUpLmpvaW4oXG4gICAgICAgIFwiLCBcIlxuICAgICAgKX0uYCxcbiAgICAgIHBsYW4uYXZvaWQ/Lmxlbmd0aCA/IGBBdm9pZDogJHt1bmlxKHBsYW4uYXZvaWQpLmpvaW4oXCIsIFwiKX0uYCA6IFwiXCIsXG4gICAgICAvLyBVbml2ZXJzYWwgY29uc3RyYWludHNcbiAgICAgIGBObyB0ZXh0LCBubyB3YXRlcm1hcmssIG5vIFVJLCBubyBsb2dvcywgbm8gc2lnbmF0dXJlcy5gLFxuICAgICAgYFNxdWFyZSBpbWFnZS5gLFxuICAgIF1cbiAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgIC5qb2luKFwiIFwiKTtcblxuICAgIGNvbnNvbGUubG9nKFwiaGFzIGZpbmFsIHByb21wdFwiLCBmaW5hbFByb21wdCk7XG5cbiAgICAvLyA0KSBJbWFnZSByZW1peCB1c2luZyBtdWx0aS1pbWFnZSBlZGl0cyAoYXJyYXkgc3ludGF4KVxuICAgIGNvbnN0IGZvcm0gPSBuZXcgRm9ybURhdGEoKTtcbiAgICBmb3JtLmFwcGVuZChcIm1vZGVsXCIsIFwiZ3B0LWltYWdlLTEuNVwiKTtcbiAgICBmb3JtLmFwcGVuZChcInByb21wdFwiLCBmaW5hbFByb21wdCk7XG4gICAgZm9ybS5hcHBlbmQoXCJzaXplXCIsIHNpemUgfHwgXCIxMDI0eDEwMjRcIik7XG4gICAgZm9ybS5hcHBlbmQoXCJvdXRwdXRfZm9ybWF0XCIsIFwianBlZ1wiKTtcblxuICAgIC8vIOKchSBrZWVwIG11bHRpLWltYWdlLCBidXQgYWxsb3cgYSBzb2Z0ZXIgaW5mbHVlbmNlIGJ5IG9yZGVyaW5nOlxuICAgIC8vIFB1dCB0aGUgXCJiYXNlXCIgZmlyc3Q7IG90aGVycyBmb2xsb3cuIChNYW55IG1vZGVscyBpbXBsaWNpdGx5IGJpYXMgZWFybGllciBpbnB1dHMuKVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW1hZ2VGaWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgZm9ybS5hcHBlbmQoXCJpbWFnZVtdXCIsIGltYWdlRmlsZXNbaV0pO1xuICAgIH1cblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKFwiaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MS9pbWFnZXMvZWRpdHNcIiwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Byb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZfWAsXG4gICAgICB9LFxuICAgICAgYm9keTogZm9ybSxcbiAgICB9KTtcblxuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCBlcnIgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBPcGVuQUkgaW1hZ2UgZWRpdCBmYWlsZWQ6ICR7ZXJyfWApO1xuICAgIH1cblxuICAgIGNvbnN0IGltZyA9IGF3YWl0IHJlcy5qc29uKCk7XG5cbiAgICBjb25zb2xlLmxvZyhcImhhcyBpbWFnZVwiLCBpbWcpO1xuXG4gICAgY29uc3QgYjY0ID0gaW1nLmRhdGE/LlswXT8uYjY0X2pzb247XG4gICAgaWYgKCFiNjQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogXCJObyBpbWFnZSByZXR1cm5lZC5cIiB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gNSkgVXBsb2FkIHJlbWl4IG91dHB1dCB0byBDbG91ZGluYXJ5XG4gICAgLy9jb25zdCByZW1peFVybCA9IGF3YWl0IHVwbG9hZEI2NFRvQ2xvdWRpbmFyeShiNjQpO1xuICAgIGNvbnN0IHJlbWl4VXJsID0gYXdhaXQgdXBsb2FkQjY0V2l0aFN0cmVhbShiNjQpO1xuXG4gICAgY29uc29sZS5sb2coXCJ1cGxvYWRlZCB0byBjbG91ZGluYXJ5IHRlbXAgZm9sZGVyXCIsIHJlbWl4VXJsKTtcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICByZW1peGVkUHJvbXB0OiBmaW5hbFByb21wdCxcbiAgICAgIHBsYW4sXG4gICAgICByZW1peFN0cmVuZ3RoOiBzdHJlbmd0aCxcbiAgICAgIGltYWdlVXJsOiByZW1peFVybCxcbiAgICAgIHBhcmVudFVybHM6IHBhcmVudHMubWFwKChwKSA9PiBwLnVybCksXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcihcIlJlbWl4IGVycm9yOlwiLCBlcnIpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6IFwiRmFpbGVkIHRvIHJlbWl4IGltYWdlc1wiIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG5cbi8qKiAtLS0tLS0tLS0tIEV4aXN0aW5nIEdFVCAoa2VwdCBmb3IgY29tcGF0aWJpbGl0eSkgLS0tLS0tLS0tLSAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gICAgY29uc3QgcHJvbXB0ID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJwcm9tcHRcIikgfHwgXCJcIjtcbiAgICBjb25zdCBhZGplY3RpdmVzID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJhZGplY3RpdmVzXCIpIHx8IFwiXCI7XG5cbiAgICBjb25zdCBjb21wbGV0aW9uID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgIG1vZGVsOiBcImdwdC0zLjUtdHVyYm9cIixcbiAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OlxuICAgICAgICAgICAgYHByZXRlbmQgdGhhdCB5b3UgYXJlIGFuIGltYWdlIHByb21wdCBlbmdpbmVlciB0aGF0IGlzIHRyeWluZyB0byBwcm9kdWNlIHNvY2lhbCBtZWRpYSBjb250ZW50LmAgK1xuICAgICAgICAgICAgYFdlIG5lZWQgdG8gd3JpdGUgYW4gaW1hZ2UgcHJvbXB0IHRoYXQgZXhwYW5kcyBvbiBhbmQgZGVwaWN0cyB0aGUgZm9sbG93aW5nIHNlbnRlbmNlOiBUaGVyZSBpcy4uLiAke3Byb21wdH0uIGAgK1xuICAgICAgICAgICAgYFRoZSBpbWFnZSBzaG91bGQgZml0IHRoaXMgdmliZTogJHthZGplY3RpdmVzfSBhbmQgYmUgaW4gdGhlIHN0eWxlIG9mIG1lZGlhdmFsIGRyYXdpbmdzIG9yIHBvc3QtaW50ZXJuZXQgZ3JhcGhpY3MgYW5kIHNjaS1maSwgYCArXG4gICAgICAgICAgICBgcGxlYXNlIG91dHB1dCBhbiBpbWFnZSBwcm9tcHQgaW4gZW5nbGlzaGAsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgbWF4X3Rva2VuczogMTAwLFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc2VudGVuY2UgPSAoY29tcGxldGlvbi5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudCB8fCBcIlwiKS5yZXBsYWNlKFxuICAgICAgJ1wiJyxcbiAgICAgIFwiXCJcbiAgICApO1xuXG4gICAgY29uc3Qgc3R5bGVTdWZmaXggPVxuICAgICAgXCJ0aGUgaW1hZ2Ugc2hvdWxkIGJlIGluIHRoZSBzdHlsZSBvZiBtaWRlYXZhbCBkcmF3aW5ncywgZmFudGFzeSwgcG9zdC1pbnRlcm5ldCBncmFwaGljcyBhbmQgc2NpLWZpLiB0aGUgaW1hZ2UgaXMgbm90IGFsbG93ZWQgdG8gc2hvdyBhbnkgY2FwdGlvbiBvciBVSSBlbGVtZW50LlwiO1xuXG4gICAgY29uc3QgaW1hZ2UgPSBhd2FpdCBvcGVuYWkuaW1hZ2VzLmdlbmVyYXRlKHtcbiAgICAgIG1vZGVsOiBcImRhbGwtZS0zXCIsXG4gICAgICBwcm9tcHQ6IGAke3NlbnRlbmNlfVxcbiR7c3R5bGVTdWZmaXh9YC50cmltKCksXG4gICAgICBuOiAxLFxuICAgICAgc2l6ZTogXCIxMDI0eDEwMjRcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICBwcm9tcHQsXG4gICAgICByZW1peGVkUHJvbXB0OiBzZW50ZW5jZSxcbiAgICAgIGltYWdlVXJsOiBpbWFnZS5kYXRhID8gaW1hZ2UuZGF0YVswXS51cmwgOiBcImltYWdldXJscGxhY2Vob2xkZXJcIixcbiAgICAgIHRhZ3M6IGFkamVjdGl2ZXMsXG4gICAgfTtcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihkYXRhKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiR2VuZXJhdGlvbiBlcnJvciAoR0VUKTpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6IFwiRmFpbGVkIHRvIGdlbmVyYXRlIGNvbnRlbnRcIiB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIk9wZW5BSSIsInYyIiwiY2xvdWRpbmFyeSIsInJ1bnRpbWUiLCJvcGVuYWkiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiLCJqb2luIiwiYXJyIiwic2VwIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiQm9vbGVhbiIsIm1hcCIsInMiLCJ0cmltIiwiY29uZmlnIiwiY2xvdWRfbmFtZSIsIkNMT1VESU5BUllfQ0xPVURfTkFNRSIsImFwaV9rZXkiLCJDTE9VRElOQVJZX0FQSV9LRVkiLCJhcGlfc2VjcmV0IiwiQ0xPVURJTkFSWV9BUElfU0VDUkVUIiwiZ2V0Q2xvdWRpbmFyeSIsInNlY3VyZSIsInRpbWVvdXQiLCJ1bmlxIiwiZnJvbSIsIlNldCIsImJ1aWxkQW5jaG9ycyIsImQiLCJvYmplY3RzIiwidmliZSIsInBlb3BsZSIsIm11c3RLZWVwIiwibXVzdF9rZWVwIiwiYW5jaG9ycyIsInNsaWNlIiwidXJsVG9GaWxlIiwidXJsIiwiZmFsbGJhY2tOYW1lIiwicmVzIiwiZmV0Y2giLCJvayIsIkVycm9yIiwic3RhdHVzIiwiY29udGVudFR5cGUiLCJoZWFkZXJzIiwiZ2V0IiwiZXh0IiwiaW5jbHVkZXMiLCJhYiIsImFycmF5QnVmZmVyIiwiYnVmIiwiQnVmZmVyIiwiRmlsZSIsInR5cGUiLCJ1cGxvYWRCNjRXaXRoU3RyZWFtIiwiYjY0Iiwib3B0cyIsImJ1ZmZlciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwic3RyZWFtIiwidXBsb2FkZXIiLCJ1cGxvYWRfc3RyZWFtIiwiZm9sZGVyIiwicmVzb3VyY2VfdHlwZSIsImZvcm1hdCIsImNvbnRleHQiLCJjYXB0aW9uIiwidGl0bGUiLCJhbHQiLCJwYXJlbnRJZHMiLCJTdHJpbmciLCJjb21tdW5pdHkiLCJ0YWdzIiwidW5kZWZpbmVkIiwiZXJyIiwicmVzdWx0Iiwic2VjdXJlX3VybCIsImVuZCIsInVwbG9hZEI2NFRvQ2xvdWRpbmFyeSIsInVwbG9hZCIsInRyYW5zZm9ybWF0aW9uIiwicXVhbGl0eSIsImZldGNoX2Zvcm1hdCIsImNvbnNvbGUiLCJlcnJvciIsIlBPU1QiLCJyZXF1ZXN0IiwiYm9keSIsImpzb24iLCJsb2ciLCJwYXJlbnRzIiwiYWRqZWN0aXZlcyIsImNvbW11bml0aWVzIiwidHJlbmRzIiwiZXh0cmFQcm9tcHQiLCJzaXplIiwicmVtaXhTdHJlbmd0aCIsImFuY2hvclBlclBhcmVudCIsImxlbmd0aCIsInN0cmVuZ3RoIiwiTWF0aCIsIm1heCIsIm1pbiIsImltYWdlRmlsZXMiLCJhbGwiLCJwIiwiaSIsInBhcmVudFN1bW1hcmllcyIsImRlc2NyaXB0b3IiLCJpbmRleCIsInN1YmplY3QiLCJzZXR0aW5nIiwibWVkaXVtIiwicmVhbGlzbSIsImxpZ2h0aW5nIiwicGFsZXR0ZSIsImNvbXBvc2l0aW9uIiwidHJlbmQiLCJmZWVsaW5nIiwic3R5bGUiLCJzY2hlbWEiLCJuYW1lIiwic3RyaWN0IiwiYWRkaXRpb25hbFByb3BlcnRpZXMiLCJwcm9wZXJ0aWVzIiwic2NlbmUiLCJzdHlsZV9ub3RlcyIsIm11c3RfaW5jbHVkZSIsIml0ZW1zIiwibWluSXRlbXMiLCJtYXhJdGVtcyIsImF2b2lkIiwicmVtaXhfZGlyZWN0aXZlIiwicmVxdWlyZWQiLCJtZXJnZVByb21wdCIsIkpTT04iLCJzdHJpbmdpZnkiLCJwbGFuUmVzcCIsImNoYXQiLCJjb21wbGV0aW9ucyIsImNyZWF0ZSIsIm1vZGVsIiwidGVtcGVyYXR1cmUiLCJtYXhfdG9rZW5zIiwicmVzcG9uc2VfZm9ybWF0IiwianNvbl9zY2hlbWEiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwicGxhblJhdyIsImNob2ljZXMiLCJtZXNzYWdlIiwicGxhbiIsInBhcnNlIiwicmVtaXhMaW5lIiwiZmluYWxQcm9tcHQiLCJmb3JtIiwiRm9ybURhdGEiLCJhcHBlbmQiLCJtZXRob2QiLCJBdXRob3JpemF0aW9uIiwidGV4dCIsImltZyIsImRhdGEiLCJiNjRfanNvbiIsInJlbWl4VXJsIiwicmVtaXhlZFByb21wdCIsImltYWdlVXJsIiwicGFyZW50VXJscyIsIkdFVCIsIlVSTCIsInByb21wdCIsInNlYXJjaFBhcmFtcyIsImNvbXBsZXRpb24iLCJzZW50ZW5jZSIsInJlcGxhY2UiLCJzdHlsZVN1ZmZpeCIsImltYWdlIiwiaW1hZ2VzIiwiZ2VuZXJhdGUiLCJuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/generateImage/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/core-js","vendor-chunks/lodash","vendor-chunks/cloudinary","vendor-chunks/cloudinary-core","vendor-chunks/q","vendor-chunks/formdata-node","vendor-chunks/ms","vendor-chunks/openai","vendor-chunks/form-data-encoder","vendor-chunks/whatwg-url","vendor-chunks/agentkeepalive","vendor-chunks/tr46","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/webidl-conversions","vendor-chunks/humanize-ms","vendor-chunks/event-target-shim","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();