"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generateImage/route";
exports.ids = ["app/api/generateImage/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_ArtDocumentation_2024_ImageEcologySimulation_ecologyAPI_src_app_api_generateImage_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/generateImage/route.ts */ \"(rsc)/./src/app/api/generateImage/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generateImage/route\",\n        pathname: \"/api/generateImage\",\n        filename: \"route\",\n        bundlePath: \"app/api/generateImage/route\"\n    },\n    resolvedPagePath: \"D:\\\\ArtDocumentation\\\\2024_ImageEcologySimulation\\\\ecologyAPI\\\\src\\\\app\\\\api\\\\generateImage\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_ArtDocumentation_2024_ImageEcologySimulation_ecologyAPI_src_app_api_generateImage_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/generateImage/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZUltYWdlJTJGcm91dGUmcGFnZT0lMkZhcGklMkZnZW5lcmF0ZUltYWdlJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGZ2VuZXJhdGVJbWFnZSUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDQXJ0RG9jdW1lbnRhdGlvbiU1QzIwMjRfSW1hZ2VFY29sb2d5U2ltdWxhdGlvbiU1Q2Vjb2xvZ3lBUEklNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUQlM0ElNUNBcnREb2N1bWVudGF0aW9uJTVDMjAyNF9JbWFnZUVjb2xvZ3lTaW11bGF0aW9uJTVDZWNvbG9neUFQSSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDcUQ7QUFDbEk7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90cmVuZHMtYWktZ2VuZXJhdG9yLz9kNDQxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkQ6XFxcXEFydERvY3VtZW50YXRpb25cXFxcMjAyNF9JbWFnZUVjb2xvZ3lTaW11bGF0aW9uXFxcXGVjb2xvZ3lBUElcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcZ2VuZXJhdGVJbWFnZVxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZ2VuZXJhdGVJbWFnZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2dlbmVyYXRlSW1hZ2VcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2dlbmVyYXRlSW1hZ2Uvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJEOlxcXFxBcnREb2N1bWVudGF0aW9uXFxcXDIwMjRfSW1hZ2VFY29sb2d5U2ltdWxhdGlvblxcXFxlY29sb2d5QVBJXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGdlbmVyYXRlSW1hZ2VcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2dlbmVyYXRlSW1hZ2Uvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/generateImage/route.ts":
/*!********************************************!*\
  !*** ./src/app/api/generateImage/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var cloudinary__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! cloudinary */ \"(rsc)/./node_modules/cloudinary/cloudinary.js\");\n/* harmony import */ var cloudinary__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(cloudinary__WEBPACK_IMPORTED_MODULE_1__);\n// app/api/generateImage/route.ts\n\n\n\nconst runtime = \"nodejs\";\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\n/** Helper: safe join */ const join = (arr, sep = \", \")=>Array.isArray(arr) ? arr.filter(Boolean).map((s)=>s.trim()).join(sep) : \"\";\ncloudinary__WEBPACK_IMPORTED_MODULE_1__.v2.config({\n    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n    api_key: process.env.CLOUDINARY_API_KEY,\n    api_secret: process.env.CLOUDINARY_API_SECRET\n});\nfunction uniq(arr) {\n    return Array.from(new Set(arr.map((s)=>s.trim()).filter(Boolean)));\n}\nfunction buildAnchors(d) {\n    const objects = Array.isArray(d?.objects) ? d.objects : [];\n    const vibe = Array.isArray(d?.vibe) ? d.vibe : [];\n    const people = Array.isArray(d?.people) ? d.people : [];\n    const mustKeep = Array.isArray(d?.must_keep) ? d.must_keep : [];\n    // Anchors: explicit must_keep first, then top objects + 1 vibe + 1 person cue\n    const anchors = uniq([\n        ...mustKeep,\n        ...objects.slice(0, 5),\n        ...vibe[0] ? [\n            vibe[0]\n        ] : [],\n        ...people[0] ? [\n            people[0]\n        ] : []\n    ]).slice(0, 10);\n    return anchors;\n}\nasync function urlToFile(url, fallbackName) {\n    const res = await fetch(url);\n    if (!res.ok) throw new Error(`Failed to fetch image: ${url} (${res.status})`);\n    const contentType = res.headers.get(\"content-type\") || \"image/jpeg\";\n    const ext = contentType.includes(\"png\") ? \"png\" : contentType.includes(\"webp\") ? \"webp\" : \"jpg\";\n    const ab = await res.arrayBuffer();\n    const buf = Buffer.from(ab);\n    // Node 18+ has File/Blob\n    return new File([\n        buf\n    ], `${fallbackName}.${ext}`, {\n        type: contentType\n    });\n}\nasync function uploadB64ToCloudinary(b64, folder = \"imageEcology\") {\n    const dataUri = `data:image/png;base64,${b64}`;\n    const uploaded = await cloudinary__WEBPACK_IMPORTED_MODULE_1__.v2.uploader.upload(dataUri, {\n        folder,\n        resource_type: \"image\"\n    });\n    return uploaded.secure_url;\n}\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        console.log(\"POST REQ: body\", body);\n        const { parents = [], adjectives = \"\", communities = [], trends = [], extraPrompt = \"\", size = \"1024x1024\", // ✅ new “looseness” knobs (optional from frontend)\n        remixStrength = 0.65, anchorPerParent = \"1-2\" } = body ?? {};\n        if (!Array.isArray(parents) || parents.length < 2) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Provide at least 2 parents.\"\n            }, {\n                status: 400\n            });\n        }\n        const strength = Math.max(0, Math.min(1, remixStrength));\n        // 1) Download parent images -> Files\n        const imageFiles = await Promise.all(parents.slice(0, 16).map((p, i)=>urlToFile(p.url, `parent-${i + 1}`)));\n        // 2) Build per-parent anchor summaries (high signal)\n        const parentSummaries = parents.slice(0, 16).map((p, i)=>{\n            const d = p.descriptor || {};\n            const anchors = buildAnchors(d);\n            return {\n                index: i + 1,\n                url: p.url,\n                subject: d.subject || \"\",\n                setting: d.setting || \"\",\n                medium: d.medium || \"\",\n                realism: d.realism || \"\",\n                lighting: d.lighting || \"\",\n                palette: d.palette || \"\",\n                composition: d.composition || \"\",\n                vibe: Array.isArray(d.vibe) ? d.vibe : [],\n                people: Array.isArray(d.people) ? d.people : [],\n                objects: Array.isArray(d.objects) ? d.objects : [],\n                trend: d.trend || \"\",\n                feeling: d.feeling || \"\",\n                style: d.style || \"\",\n                anchors\n            };\n        });\n        // 3) Ask LLM for a *merged plan* (Structured Outputs), then render a final prompt\n        const schema = {\n            name: \"RemixPlan\",\n            strict: true,\n            schema: {\n                type: \"object\",\n                additionalProperties: false,\n                properties: {\n                    scene: {\n                        type: \"string\"\n                    },\n                    subject: {\n                        type: \"string\"\n                    },\n                    setting: {\n                        type: \"string\"\n                    },\n                    composition: {\n                        type: \"string\"\n                    },\n                    medium: {\n                        type: \"string\"\n                    },\n                    realism: {\n                        type: \"string\"\n                    },\n                    lighting: {\n                        type: \"string\"\n                    },\n                    palette: {\n                        type: \"string\"\n                    },\n                    style_notes: {\n                        type: \"string\"\n                    },\n                    must_include: {\n                        type: \"array\",\n                        items: {\n                            type: \"string\"\n                        },\n                        minItems: 4,\n                        maxItems: 16\n                    },\n                    avoid: {\n                        type: \"array\",\n                        items: {\n                            type: \"string\"\n                        },\n                        minItems: 0,\n                        maxItems: 14\n                    },\n                    // ✅ new: give the model explicit “remix permission” in output too\n                    remix_directive: {\n                        type: \"string\"\n                    }\n                },\n                required: [\n                    \"scene\",\n                    \"subject\",\n                    \"setting\",\n                    \"composition\",\n                    \"medium\",\n                    \"realism\",\n                    \"lighting\",\n                    \"palette\",\n                    \"style_notes\",\n                    \"must_include\",\n                    \"avoid\",\n                    \"remix_directive\"\n                ]\n            }\n        };\n        // ✅ NEW: creative remix rules + less rigid anchors + composition freedom\n        // We still ensure recognizability via must_include, but allow re-layout/fusion.\n        const mergePrompt = [\n            `Create ONE coherent remix plan from multiple parent images.`,\n            ``,\n            `Remix intent (critical):`,\n            `- The output should feel like a NEW image inspired by the parents, not a faithful copy.`,\n            `- You are allowed to reinterpret, resize, relocate, fuse, or stylize elements from all parents.`,\n            `- Preserve recognizability, but not exact layout, camera angle, or proportions.`,\n            `- You MAY change composition, perspective, framing, scale, and staging for higher impact.`,\n            `- Prefer surprising, meme-forward recombinations while keeping it visually coherent.`,\n            ``,\n            `Anchor rules:`,\n            `- Include at least ${anchorPerParent} recognizable anchor items from EACH parent (use parentSummaries[*].anchors).`,\n            `- Anchors can appear as props, background motifs, wardrobe details, environment cues, or fused elements.`,\n            `- Do NOT just “list” anchors; integrate them naturally into the scene.`,\n            ``,\n            `Style rules:`,\n            `- Choose ONE dominant medium + realism; harmonize lighting/palette.`,\n            `- If parents conflict, blend them into a single aesthetic (do not enumerate styles).`,\n            ``,\n            `Output constraints:`,\n            `- Unify into a single world (no grid/collage).`,\n            `- Keep it social-media-friendly and visually striking.`,\n            `- No text, no watermark, no UI.`,\n            ``,\n            `Creative looseness:`,\n            `- remixStrength=${strength} where 0=faithful edit and 1=highly remixed.`,\n            `- At higher remixStrength, push more transformation and unexpected composition shifts.`,\n            ``,\n            `Context tags:`,\n            adjectives ? `- vibe/tags: ${adjectives}` : \"\",\n            communities?.length ? `- community: ${communities.join(\", \")}` : \"\",\n            trends?.length ? `- trends: ${trends.join(\", \")}` : \"\",\n            extraPrompt ? `- extra: ${extraPrompt}` : \"\",\n            \"\",\n            `Parent summaries (anchors + style fields):`,\n            JSON.stringify(parentSummaries)\n        ].filter(Boolean).join(\"\\n\");\n        const planResp = await openai.chat.completions.create({\n            model: \"gpt-4o-mini\",\n            temperature: 0.55,\n            max_tokens: 650,\n            response_format: {\n                type: \"json_schema\",\n                json_schema: schema\n            },\n            messages: [\n                {\n                    role: \"system\",\n                    content: \"Return only JSON matching the schema. Prefer concrete visual anchors. Keep the plan remixy, not literal. Use remixStrength to decide how bold to be.\"\n                },\n                {\n                    role: \"user\",\n                    content: mergePrompt\n                }\n            ]\n        });\n        const planRaw = planResp.choices[0]?.message?.content ?? \"{}\";\n        const plan = JSON.parse(planRaw);\n        // ✅ NEW: bake in “remix permission” directly into the final prompt\n        // Also: scale the language based on remixStrength.\n        const remixLine = strength >= 0.8 ? \"Highly remixed reinterpretation with bold recomposition and surprising fusions.\" : strength >= 0.5 ? \"Creative remix reinterpretation; allow recomposition, scale shifts, and fused elements.\" : \"Light remix; small but noticeable rearrangements and stylized integrations.\";\n        const finalPrompt = [\n            // Core\n            `${plan.scene}. ${plan.subject}. ${plan.setting}.`,\n            // Remix directive (important for the image model)\n            remixLine,\n            plan.remix_directive ? plan.remix_directive : \"\",\n            // Visual control (but not too rigid)\n            `Composition: ${plan.composition}.`,\n            `Medium: ${plan.medium}, realism: ${plan.realism}.`,\n            `Lighting: ${plan.lighting}. Palette: ${plan.palette}.`,\n            plan.style_notes ? `Style: ${plan.style_notes}.` : \"\",\n            // Anchors\n            `Must include (integrated naturally): ${uniq(plan.must_include).join(\", \")}.`,\n            plan.avoid?.length ? `Avoid: ${uniq(plan.avoid).join(\", \")}.` : \"\",\n            // Universal constraints\n            `No text, no watermark, no UI, no logos, no signatures.`,\n            `Square image.`\n        ].filter(Boolean).join(\" \");\n        // 4) Image remix using multi-image edits (array syntax)\n        const form = new FormData();\n        form.append(\"model\", \"gpt-image-1.5\");\n        form.append(\"prompt\", finalPrompt);\n        form.append(\"size\", size || \"1024x1024\");\n        form.append(\"output_format\", \"png\");\n        // ✅ keep multi-image, but allow a softer influence by ordering:\n        // Put the \"base\" first; others follow. (Many models implicitly bias earlier inputs.)\n        for(let i = 0; i < imageFiles.length; i++){\n            form.append(\"image[]\", imageFiles[i]);\n        }\n        const res = await fetch(\"https://api.openai.com/v1/images/edits\", {\n            method: \"POST\",\n            headers: {\n                Authorization: `Bearer ${process.env.OPENAI_API_KEY}`\n            },\n            body: form\n        });\n        if (!res.ok) {\n            const err = await res.text();\n            throw new Error(`OpenAI image edit failed: ${err}`);\n        }\n        const img = await res.json();\n        const b64 = img.data?.[0]?.b64_json;\n        if (!b64) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No image returned.\"\n            }, {\n                status: 500\n            });\n        }\n        // 5) Upload remix output to Cloudinary\n        const remixUrl = await uploadB64ToCloudinary(b64);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            remixedPrompt: finalPrompt,\n            plan,\n            remixStrength: strength,\n            imageUrl: remixUrl,\n            parentUrls: parents.map((p)=>p.url)\n        });\n    } catch (err) {\n        console.error(\"Remix error:\", err);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to remix images\"\n        }, {\n            status: 500\n        });\n    }\n}\n/** ---------- Existing GET (kept for compatibility) ---------- */ async function GET(request) {\n    try {\n        const url = new URL(request.url);\n        const prompt = url.searchParams.get(\"prompt\") || \"\";\n        const adjectives = url.searchParams.get(\"adjectives\") || \"\";\n        const completion = await openai.chat.completions.create({\n            model: \"gpt-3.5-turbo\",\n            messages: [\n                {\n                    role: \"user\",\n                    content: `pretend that you are an image prompt engineer that is trying to produce social media content.` + `We need to write an image prompt that expands on and depicts the following sentence: There is... ${prompt}. ` + `The image should fit this vibe: ${adjectives} and be in the style of mediaval drawings or post-internet graphics and sci-fi, ` + `please output an image prompt in english`\n                }\n            ],\n            max_tokens: 100\n        });\n        const sentence = (completion.choices[0].message.content || \"\").replace('\"', \"\");\n        const styleSuffix = \"the image should be in the style of mideaval drawings, fantasy, post-internet graphics and sci-fi. the image is not allowed to show any caption or UI element.\";\n        const image = await openai.images.generate({\n            model: \"dall-e-3\",\n            prompt: `${sentence}\\n${styleSuffix}`.trim(),\n            n: 1,\n            size: \"1024x1024\"\n        });\n        const data = {\n            prompt,\n            remixedPrompt: sentence,\n            imageUrl: image.data ? image.data[0].url : \"imageurlplaceholder\",\n            tags: adjectives\n        };\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(data);\n    } catch (error) {\n        console.error(\"Generation error (GET):\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to generate content\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9nZW5lcmF0ZUltYWdlL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxpQ0FBaUM7QUFDVTtBQUNmO0FBQ2tCO0FBRXZDLE1BQU1JLFVBQVUsU0FBUztBQUVoQyxNQUFNQyxTQUFTLElBQUlKLDhDQUFNQSxDQUFDO0lBQUVLLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztBQUFDO0FBUy9ELHNCQUFzQixHQUN0QixNQUFNQyxPQUFPLENBQUNDLEtBQXVCQyxNQUFNLElBQUksR0FDN0NDLE1BQU1DLE9BQU8sQ0FBQ0gsT0FDVkEsSUFDR0ksTUFBTSxDQUFDQyxTQUNQQyxHQUFHLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRUMsSUFBSSxJQUNqQlQsSUFBSSxDQUFDRSxPQUNSO0FBRU5ULDBDQUFVQSxDQUFDaUIsTUFBTSxDQUFDO0lBQ2hCQyxZQUFZZCxRQUFRQyxHQUFHLENBQUNjLHFCQUFxQjtJQUM3Q0MsU0FBU2hCLFFBQVFDLEdBQUcsQ0FBQ2dCLGtCQUFrQjtJQUN2Q0MsWUFBWWxCLFFBQVFDLEdBQUcsQ0FBQ2tCLHFCQUFxQjtBQUMvQztBQWlDQSxTQUFTQyxLQUFLaEIsR0FBYTtJQUN6QixPQUFPRSxNQUFNZSxJQUFJLENBQUMsSUFBSUMsSUFBSWxCLElBQUlNLEdBQUcsQ0FBQyxDQUFDQyxJQUFNQSxFQUFFQyxJQUFJLElBQUlKLE1BQU0sQ0FBQ0M7QUFDNUQ7QUFFQSxTQUFTYyxhQUFhQyxDQUErQjtJQUNuRCxNQUFNQyxVQUFVbkIsTUFBTUMsT0FBTyxDQUFDaUIsR0FBR0MsV0FBV0QsRUFBR0MsT0FBTyxHQUFJLEVBQUU7SUFDNUQsTUFBTUMsT0FBT3BCLE1BQU1DLE9BQU8sQ0FBQ2lCLEdBQUdFLFFBQVFGLEVBQUdFLElBQUksR0FBSSxFQUFFO0lBQ25ELE1BQU1DLFNBQVNyQixNQUFNQyxPQUFPLENBQUNpQixHQUFHRyxVQUFVSCxFQUFHRyxNQUFNLEdBQUksRUFBRTtJQUN6RCxNQUFNQyxXQUFX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R2MsTUFBTWQsSUFBSSxDQUFDLEVBQUUsQ0FBQzdHLEdBQUcsR0FBRztZQUMzQytILE1BQU03RjtRQUNSO1FBRUEsT0FBTzFFLHFEQUFZQSxDQUFDc0UsSUFBSSxDQUFDK0U7SUFDM0IsRUFBRSxPQUFPbkUsT0FBTztRQUNkWCxRQUFRVyxLQUFLLENBQUMsMkJBQTJCQTtRQUN6QyxPQUFPbEYscURBQVlBLENBQUNzRSxJQUFJLENBQ3RCO1lBQUVZLE9BQU87UUFBNkIsR0FDdEM7WUFBRXBDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdHJlbmRzLWFpLWdlbmVyYXRvci8uL3NyYy9hcHAvYXBpL2dlbmVyYXRlSW1hZ2Uvcm91dGUudHM/ZWQ3ZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBhcHAvYXBpL2dlbmVyYXRlSW1hZ2Uvcm91dGUudHNcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IE9wZW5BSSBmcm9tIFwib3BlbmFpXCI7XG5pbXBvcnQgeyB2MiBhcyBjbG91ZGluYXJ5IH0gZnJvbSBcImNsb3VkaW5hcnlcIjtcblxuZXhwb3J0IGNvbnN0IHJ1bnRpbWUgPSBcIm5vZGVqc1wiO1xuXG5jb25zdCBvcGVuYWkgPSBuZXcgT3BlbkFJKHsgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSB9KTtcblxuZXhwb3J0IGludGVyZmFjZSBHZW5lcmF0aW9uUmVzdWx0IHtcbiAgc2VudGVuY2U6IHN0cmluZztcbiAgaW1hZ2VVcmw6IHN0cmluZztcbiAgdHJlbmRzOiBzdHJpbmdbXTtcbiAgZ2VvOiBzdHJpbmc7XG59XG5cbi8qKiBIZWxwZXI6IHNhZmUgam9pbiAqL1xuY29uc3Qgam9pbiA9IChhcnI/OiBzdHJpbmdbXSB8IG51bGwsIHNlcCA9IFwiLCBcIikgPT5cbiAgQXJyYXkuaXNBcnJheShhcnIpXG4gICAgPyBhcnJcbiAgICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgICAubWFwKChzKSA9PiBzLnRyaW0oKSlcbiAgICAgICAgLmpvaW4oc2VwKVxuICAgIDogXCJcIjtcblxuY2xvdWRpbmFyeS5jb25maWcoe1xuICBjbG91ZF9uYW1lOiBwcm9jZXNzLmVudi5DTE9VRElOQVJZX0NMT1VEX05BTUUsXG4gIGFwaV9rZXk6IHByb2Nlc3MuZW52LkNMT1VESU5BUllfQVBJX0tFWSxcbiAgYXBpX3NlY3JldDogcHJvY2Vzcy5lbnYuQ0xPVURJTkFSWV9BUElfU0VDUkVULFxufSk7XG5cbnR5cGUgUGFyZW50RGVzY3JpcHRvciA9IHtcbiAgLy8gTWluaW1hbFxuICB0aXRsZT86IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG5cbiAgLy8gTmV3IHN0cnVjdHVyZWQgZmllbGRzIChyZWNvbW1lbmRlZClcbiAgc3ViamVjdD86IHN0cmluZztcbiAgc2V0dGluZz86IHN0cmluZztcbiAgbWVkaXVtPzogc3RyaW5nOyAvLyBcIjNEIHJlbmRlclwiIHwgXCJwaG90b2dyYXBoXCIgfCBcImlsbHVzdHJhdGlvblwiIGV0Yy5cbiAgcmVhbGlzbT86IHN0cmluZzsgLy8gXCJwaG90b3JlYWxpc3RpY1wiIHwgXCJzdHlsaXplZFwiIGV0Yy5cbiAgbGlnaHRpbmc/OiBzdHJpbmc7XG4gIHBhbGV0dGU/OiBzdHJpbmc7XG4gIGNvbXBvc2l0aW9uPzogc3RyaW5nO1xuXG4gIC8vIEV4aXN0aW5nIGZpZWxkcyB5b3UgYWxyZWFkeSBoYXZlXG4gIHN0eWxlPzogc3RyaW5nO1xuICB2aWJlPzogc3RyaW5nW107XG4gIG9iamVjdHM/OiBzdHJpbmdbXTtcbiAgcGVvcGxlPzogc3RyaW5nW107XG4gIHRyZW5kPzogc3RyaW5nO1xuICBmZWVsaW5nPzogc3RyaW5nO1xuXG4gIC8vIEFuY2hvcnNcbiAgbXVzdF9rZWVwPzogc3RyaW5nW107IC8vIDPigJM4IGl0ZW1zIHRoYXQgc2hvdWxkIHN1cnZpdmUgdGhlIHJlbWl4XG59O1xuXG50eXBlIFJlbWl4UGFyZW50ID0ge1xuICB1cmw6IHN0cmluZzsgLy8gQ2xvdWRpbmFyeSBVUkwgb3IgYW55IHB1YmxpYyBVUkxcbiAgZGVzY3JpcHRvcj86IFBhcmVudERlc2NyaXB0b3I7XG59O1xuXG5mdW5jdGlvbiB1bmlxKGFycjogc3RyaW5nW10pIHtcbiAgcmV0dXJuIEFycmF5LmZyb20obmV3IFNldChhcnIubWFwKChzKSA9PiBzLnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pKSk7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQW5jaG9ycyhkOiBQYXJlbnREZXNjcmlwdG9yIHwgdW5kZWZpbmVkKSB7XG4gIGNvbnN0IG9iamVjdHMgPSBBcnJheS5pc0FycmF5KGQ/Lm9iamVjdHMpID8gZCEub2JqZWN0cyEgOiBbXTtcbiAgY29uc3QgdmliZSA9IEFycmF5LmlzQXJyYXkoZD8udmliZSkgPyBkIS52aWJlISA6IFtdO1xuICBjb25zdCBwZW9wbGUgPSBBcnJheS5pc0FycmF5KGQ/LnBlb3BsZSkgPyBkIS5wZW9wbGUhIDogW107XG4gIGNvbnN0IG11c3RLZWVwID0gQXJyYXkuaXNBcnJheShkPy5tdXN0X2tlZXApID8gZCEubXVzdF9rZWVwISA6IFtdO1xuXG4gIC8vIEFuY2hvcnM6IGV4cGxpY2l0IG11c3Rfa2VlcCBmaXJzdCwgdGhlbiB0b3Agb2JqZWN0cyArIDEgdmliZSArIDEgcGVyc29uIGN1ZVxuICBjb25zdCBhbmNob3JzID0gdW5pcShbXG4gICAgLi4ubXVzdEtlZXAsXG4gICAgLi4ub2JqZWN0cy5zbGljZSgwLCA1KSxcbiAgICAuLi4odmliZVswXSA/IFt2aWJlWzBdXSA6IFtdKSxcbiAgICAuLi4ocGVvcGxlWzBdID8gW3Blb3BsZVswXV0gOiBbXSksXG4gIF0pLnNsaWNlKDAsIDEwKTtcblxuICByZXR1cm4gYW5jaG9ycztcbn1cblxuYXN5bmMgZnVuY3Rpb24gdXJsVG9GaWxlKHVybDogc3RyaW5nLCBmYWxsYmFja05hbWU6IHN0cmluZyk6IFByb21pc2U8RmlsZT4ge1xuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwpO1xuICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggaW1hZ2U6ICR7dXJsfSAoJHtyZXMuc3RhdHVzfSlgKTtcblxuICBjb25zdCBjb250ZW50VHlwZSA9IHJlcy5oZWFkZXJzLmdldChcImNvbnRlbnQtdHlwZVwiKSB8fCBcImltYWdlL2pwZWdcIjtcbiAgY29uc3QgZXh0ID0gY29udGVudFR5cGUuaW5jbHVkZXMoXCJwbmdcIilcbiAgICA/IFwicG5nXCJcbiAgICA6IGNvbnRlbnRUeXBlLmluY2x1ZGVzKFwid2VicFwiKVxuICAgID8gXCJ3ZWJwXCJcbiAgICA6IFwianBnXCI7XG5cbiAgY29uc3QgYWIgPSBhd2FpdCByZXMuYXJyYXlCdWZmZXIoKTtcbiAgY29uc3QgYnVmID0gQnVmZmVyLmZyb20oYWIpO1xuXG4gIC8vIE5vZGUgMTgrIGhhcyBGaWxlL0Jsb2JcbiAgcmV0dXJuIG5ldyBGaWxlKFtidWZdLCBgJHtmYWxsYmFja05hbWV9LiR7ZXh0fWAsIHsgdHlwZTogY29udGVudFR5cGUgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVwbG9hZEI2NFRvQ2xvdWRpbmFyeShiNjQ6IHN0cmluZywgZm9sZGVyID0gXCJpbWFnZUVjb2xvZ3lcIikge1xuICBjb25zdCBkYXRhVXJpID0gYGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwke2I2NH1gO1xuICBjb25zdCB1cGxvYWRlZCA9IGF3YWl0IGNsb3VkaW5hcnkudXBsb2FkZXIudXBsb2FkKGRhdGFVcmksIHtcbiAgICBmb2xkZXIsXG4gICAgcmVzb3VyY2VfdHlwZTogXCJpbWFnZVwiLFxuICB9KTtcbiAgcmV0dXJuIHVwbG9hZGVkLnNlY3VyZV91cmw7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG5cbiAgICBjb25zb2xlLmxvZyhcIlBPU1QgUkVROiBib2R5XCIsIGJvZHkpO1xuXG4gICAgY29uc3Qge1xuICAgICAgcGFyZW50cyA9IFtdLFxuICAgICAgYWRqZWN0aXZlcyA9IFwiXCIsXG4gICAgICBjb21tdW5pdGllcyA9IFtdLFxuICAgICAgdHJlbmRzID0gW10sXG4gICAgICBleHRyYVByb21wdCA9IFwiXCIsXG4gICAgICBzaXplID0gXCIxMDI0eDEwMjRcIixcblxuICAgICAgLy8g4pyFIG5ldyDigJxsb29zZW5lc3PigJ0ga25vYnMgKG9wdGlvbmFsIGZyb20gZnJvbnRlbmQpXG4gICAgICByZW1peFN0cmVuZ3RoID0gMC42NSwgLy8gMCAocmlnaWQpIOKGkiAxICh2ZXJ5IHJlbWl4eSlcbiAgICAgIGFuY2hvclBlclBhcmVudCA9IFwiMS0yXCIsIC8vIFwiMS0yXCIgb3IgXCIyXCIgZXRjLlxuICAgIH06IHtcbiAgICAgIHBhcmVudHM6IFJlbWl4UGFyZW50W107XG4gICAgICBhZGplY3RpdmVzPzogc3RyaW5nO1xuICAgICAgY29tbXVuaXRpZXM/OiBzdHJpbmdbXTtcbiAgICAgIHRyZW5kcz86IHN0cmluZ1tdO1xuICAgICAgZXh0cmFQcm9tcHQ/OiBzdHJpbmc7XG4gICAgICBzaXplPzogXCIxMDI0eDEwMjRcIiB8IFwiMTUzNngxMDI0XCIgfCBcIjEwMjR4MTUzNlwiIHwgXCJhdXRvXCI7XG4gICAgICByZW1peFN0cmVuZ3RoPzogbnVtYmVyO1xuICAgICAgYW5jaG9yUGVyUGFyZW50PzogXCIxLTJcIiB8IFwiMlwiIHwgXCIyLTNcIjtcbiAgICB9ID0gYm9keSA/PyB7fTtcblxuICAgIGlmICghQXJyYXkuaXNBcnJheShwYXJlbnRzKSB8fCBwYXJlbnRzLmxlbmd0aCA8IDIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogXCJQcm92aWRlIGF0IGxlYXN0IDIgcGFyZW50cy5cIiB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RyZW5ndGggPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCByZW1peFN0cmVuZ3RoKSk7XG5cbiAgICAvLyAxKSBEb3dubG9hZCBwYXJlbnQgaW1hZ2VzIC0+IEZpbGVzXG4gICAgY29uc3QgaW1hZ2VGaWxlczogRmlsZVtdID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBwYXJlbnRzLnNsaWNlKDAsIDE2KS5tYXAoKHAsIGkpID0+IHVybFRvRmlsZShwLnVybCwgYHBhcmVudC0ke2kgKyAxfWApKVxuICAgICk7XG5cbiAgICAvLyAyKSBCdWlsZCBwZXItcGFyZW50IGFuY2hvciBzdW1tYXJpZXMgKGhpZ2ggc2lnbmFsKVxuICAgIGNvbnN0IHBhcmVudFN1bW1hcmllcyA9IHBhcmVudHMuc2xpY2UoMCwgMTYpLm1hcCgocCwgaSkgPT4ge1xuICAgICAgY29uc3QgZCA9IHAuZGVzY3JpcHRvciB8fCB7fTtcbiAgICAgIGNvbnN0IGFuY2hvcnMgPSBidWlsZEFuY2hvcnMoZCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGluZGV4OiBpICsgMSxcbiAgICAgICAgdXJsOiBwLnVybCxcbiAgICAgICAgc3ViamVjdDogZC5zdWJqZWN0IHx8IFwiXCIsXG4gICAgICAgIHNldHRpbmc6IGQuc2V0dGluZyB8fCBcIlwiLFxuICAgICAgICBtZWRpdW06IGQubWVkaXVtIHx8IFwiXCIsXG4gICAgICAgIHJlYWxpc206IGQucmVhbGlzbSB8fCBcIlwiLFxuICAgICAgICBsaWdodGluZzogZC5saWdodGluZyB8fCBcIlwiLFxuICAgICAgICBwYWxldHRlOiBkLnBhbGV0dGUgfHwgXCJcIixcbiAgICAgICAgY29tcG9zaXRpb246IGQuY29tcG9zaXRpb24gfHwgXCJcIixcbiAgICAgICAgdmliZTogQXJyYXkuaXNBcnJheShkLnZpYmUpID8gZC52aWJlIDogW10sXG4gICAgICAgIHBlb3BsZTogQXJyYXkuaXNBcnJheShkLnBlb3BsZSkgPyBkLnBlb3BsZSA6IFtdLFxuICAgICAgICBvYmplY3RzOiBBcnJheS5pc0FycmF5KGQub2JqZWN0cykgPyBkLm9iamVjdHMgOiBbXSxcbiAgICAgICAgdHJlbmQ6IGQudHJlbmQgfHwgXCJcIixcbiAgICAgICAgZmVlbGluZzogZC5mZWVsaW5nIHx8IFwiXCIsXG4gICAgICAgIHN0eWxlOiBkLnN0eWxlIHx8IFwiXCIsXG4gICAgICAgIGFuY2hvcnMsXG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgLy8gMykgQXNrIExMTSBmb3IgYSAqbWVyZ2VkIHBsYW4qIChTdHJ1Y3R1cmVkIE91dHB1dHMpLCB0aGVuIHJlbmRlciBhIGZpbmFsIHByb21wdFxuICAgIGNvbnN0IHNjaGVtYSA9IHtcbiAgICAgIG5hbWU6IFwiUmVtaXhQbGFuXCIsXG4gICAgICBzdHJpY3Q6IHRydWUsXG4gICAgICBzY2hlbWE6IHtcbiAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgYWRkaXRpb25hbFByb3BlcnRpZXM6IGZhbHNlLFxuICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgc2NlbmU6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIHN1YmplY3Q6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIHNldHRpbmc6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIGNvbXBvc2l0aW9uOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICBtZWRpdW06IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIHJlYWxpc206IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIGxpZ2h0aW5nOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICBwYWxldHRlOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICBzdHlsZV9ub3RlczogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgbXVzdF9pbmNsdWRlOiB7XG4gICAgICAgICAgICB0eXBlOiBcImFycmF5XCIsXG4gICAgICAgICAgICBpdGVtczogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgICBtaW5JdGVtczogNCxcbiAgICAgICAgICAgIG1heEl0ZW1zOiAxNixcbiAgICAgICAgICB9LFxuICAgICAgICAgIGF2b2lkOiB7XG4gICAgICAgICAgICB0eXBlOiBcImFycmF5XCIsXG4gICAgICAgICAgICBpdGVtczogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgICBtaW5JdGVtczogMCxcbiAgICAgICAgICAgIG1heEl0ZW1zOiAxNCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8vIOKchSBuZXc6IGdpdmUgdGhlIG1vZGVsIGV4cGxpY2l0IOKAnHJlbWl4IHBlcm1pc3Npb27igJ0gaW4gb3V0cHV0IHRvb1xuICAgICAgICAgIHJlbWl4X2RpcmVjdGl2ZTogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHJlcXVpcmVkOiBbXG4gICAgICAgICAgXCJzY2VuZVwiLFxuICAgICAgICAgIFwic3ViamVjdFwiLFxuICAgICAgICAgIFwic2V0dGluZ1wiLFxuICAgICAgICAgIFwiY29tcG9zaXRpb25cIixcbiAgICAgICAgICBcIm1lZGl1bVwiLFxuICAgICAgICAgIFwicmVhbGlzbVwiLFxuICAgICAgICAgIFwibGlnaHRpbmdcIixcbiAgICAgICAgICBcInBhbGV0dGVcIixcbiAgICAgICAgICBcInN0eWxlX25vdGVzXCIsXG4gICAgICAgICAgXCJtdXN0X2luY2x1ZGVcIixcbiAgICAgICAgICBcImF2b2lkXCIsXG4gICAgICAgICAgXCJyZW1peF9kaXJlY3RpdmVcIixcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgfSBhcyBjb25zdDtcblxuICAgIC8vIOKchSBORVc6IGNyZWF0aXZlIHJlbWl4IHJ1bGVzICsgbGVzcyByaWdpZCBhbmNob3JzICsgY29tcG9zaXRpb24gZnJlZWRvbVxuICAgIC8vIFdlIHN0aWxsIGVuc3VyZSByZWNvZ25pemFiaWxpdHkgdmlhIG11c3RfaW5jbHVkZSwgYnV0IGFsbG93IHJlLWxheW91dC9mdXNpb24uXG4gICAgY29uc3QgbWVyZ2VQcm9tcHQgPSBbXG4gICAgICBgQ3JlYXRlIE9ORSBjb2hlcmVudCByZW1peCBwbGFuIGZyb20gbXVsdGlwbGUgcGFyZW50IGltYWdlcy5gLFxuICAgICAgYGAsXG4gICAgICBgUmVtaXggaW50ZW50IChjcml0aWNhbCk6YCxcbiAgICAgIGAtIFRoZSBvdXRwdXQgc2hvdWxkIGZlZWwgbGlrZSBhIE5FVyBpbWFnZSBpbnNwaXJlZCBieSB0aGUgcGFyZW50cywgbm90IGEgZmFpdGhmdWwgY29weS5gLFxuICAgICAgYC0gWW91IGFyZSBhbGxvd2VkIHRvIHJlaW50ZXJwcmV0LCByZXNpemUsIHJlbG9jYXRlLCBmdXNlLCBvciBzdHlsaXplIGVsZW1lbnRzIGZyb20gYWxsIHBhcmVudHMuYCxcbiAgICAgIGAtIFByZXNlcnZlIHJlY29nbml6YWJpbGl0eSwgYnV0IG5vdCBleGFjdCBsYXlvdXQsIGNhbWVyYSBhbmdsZSwgb3IgcHJvcG9ydGlvbnMuYCxcbiAgICAgIGAtIFlvdSBNQVkgY2hhbmdlIGNvbXBvc2l0aW9uLCBwZXJzcGVjdGl2ZSwgZnJhbWluZywgc2NhbGUsIGFuZCBzdGFnaW5nIGZvciBoaWdoZXIgaW1wYWN0LmAsXG4gICAgICBgLSBQcmVmZXIgc3VycHJpc2luZywgbWVtZS1mb3J3YXJkIHJlY29tYmluYXRpb25zIHdoaWxlIGtlZXBpbmcgaXQgdmlzdWFsbHkgY29oZXJlbnQuYCxcbiAgICAgIGBgLFxuICAgICAgYEFuY2hvciBydWxlczpgLFxuICAgICAgYC0gSW5jbHVkZSBhdCBsZWFzdCAke2FuY2hvclBlclBhcmVudH0gcmVjb2duaXphYmxlIGFuY2hvciBpdGVtcyBmcm9tIEVBQ0ggcGFyZW50ICh1c2UgcGFyZW50U3VtbWFyaWVzWypdLmFuY2hvcnMpLmAsXG4gICAgICBgLSBBbmNob3JzIGNhbiBhcHBlYXIgYXMgcHJvcHMsIGJhY2tncm91bmQgbW90aWZzLCB3YXJkcm9iZSBkZXRhaWxzLCBlbnZpcm9ubWVudCBjdWVzLCBvciBmdXNlZCBlbGVtZW50cy5gLFxuICAgICAgYC0gRG8gTk9UIGp1c3Qg4oCcbGlzdOKAnSBhbmNob3JzOyBpbnRlZ3JhdGUgdGhlbSBuYXR1cmFsbHkgaW50byB0aGUgc2NlbmUuYCxcbiAgICAgIGBgLFxuICAgICAgYFN0eWxlIHJ1bGVzOmAsXG4gICAgICBgLSBDaG9vc2UgT05FIGRvbWluYW50IG1lZGl1bSArIHJlYWxpc207IGhhcm1vbml6ZSBsaWdodGluZy9wYWxldHRlLmAsXG4gICAgICBgLSBJZiBwYXJlbnRzIGNvbmZsaWN0LCBibGVuZCB0aGVtIGludG8gYSBzaW5nbGUgYWVzdGhldGljIChkbyBub3QgZW51bWVyYXRlIHN0eWxlcykuYCxcbiAgICAgIGBgLFxuICAgICAgYE91dHB1dCBjb25zdHJhaW50czpgLFxuICAgICAgYC0gVW5pZnkgaW50byBhIHNpbmdsZSB3b3JsZCAobm8gZ3JpZC9jb2xsYWdlKS5gLFxuICAgICAgYC0gS2VlcCBpdCBzb2NpYWwtbWVkaWEtZnJpZW5kbHkgYW5kIHZpc3VhbGx5IHN0cmlraW5nLmAsXG4gICAgICBgLSBObyB0ZXh0LCBubyB3YXRlcm1hcmssIG5vIFVJLmAsXG4gICAgICBgYCxcbiAgICAgIGBDcmVhdGl2ZSBsb29zZW5lc3M6YCxcbiAgICAgIGAtIHJlbWl4U3RyZW5ndGg9JHtzdHJlbmd0aH0gd2hlcmUgMD1mYWl0aGZ1bCBlZGl0IGFuZCAxPWhpZ2hseSByZW1peGVkLmAsXG4gICAgICBgLSBBdCBoaWdoZXIgcmVtaXhTdHJlbmd0aCwgcHVzaCBtb3JlIHRyYW5zZm9ybWF0aW9uIGFuZCB1bmV4cGVjdGVkIGNvbXBvc2l0aW9uIHNoaWZ0cy5gLFxuICAgICAgYGAsXG4gICAgICBgQ29udGV4dCB0YWdzOmAsXG4gICAgICBhZGplY3RpdmVzID8gYC0gdmliZS90YWdzOiAke2FkamVjdGl2ZXN9YCA6IFwiXCIsXG4gICAgICBjb21tdW5pdGllcz8ubGVuZ3RoID8gYC0gY29tbXVuaXR5OiAke2NvbW11bml0aWVzLmpvaW4oXCIsIFwiKX1gIDogXCJcIixcbiAgICAgIHRyZW5kcz8ubGVuZ3RoID8gYC0gdHJlbmRzOiAke3RyZW5kcy5qb2luKFwiLCBcIil9YCA6IFwiXCIsXG4gICAgICBleHRyYVByb21wdCA/IGAtIGV4dHJhOiAke2V4dHJhUHJvbXB0fWAgOiBcIlwiLFxuICAgICAgXCJcIixcbiAgICAgIGBQYXJlbnQgc3VtbWFyaWVzIChhbmNob3JzICsgc3R5bGUgZmllbGRzKTpgLFxuICAgICAgSlNPTi5zdHJpbmdpZnkocGFyZW50U3VtbWFyaWVzKSxcbiAgICBdXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgICAuam9pbihcIlxcblwiKTtcblxuICAgIGNvbnN0IHBsYW5SZXNwID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgIG1vZGVsOiBcImdwdC00by1taW5pXCIsXG4gICAgICB0ZW1wZXJhdHVyZTogMC41NSwgLy8g4pyFIHNsaWdodGx5IGhpZ2hlciB0byBlbmNvdXJhZ2UgbW9yZSBub3ZlbCByZWNvbWJpbmF0aW9uXG4gICAgICBtYXhfdG9rZW5zOiA2NTAsXG4gICAgICByZXNwb25zZV9mb3JtYXQ6IHsgdHlwZTogXCJqc29uX3NjaGVtYVwiLCBqc29uX3NjaGVtYTogc2NoZW1hIH0sXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OlxuICAgICAgICAgICAgXCJSZXR1cm4gb25seSBKU09OIG1hdGNoaW5nIHRoZSBzY2hlbWEuIFByZWZlciBjb25jcmV0ZSB2aXN1YWwgYW5jaG9ycy4gS2VlcCB0aGUgcGxhbiByZW1peHksIG5vdCBsaXRlcmFsLiBVc2UgcmVtaXhTdHJlbmd0aCB0byBkZWNpZGUgaG93IGJvbGQgdG8gYmUuXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IG1lcmdlUHJvbXB0IH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcGxhblJhdyA9IHBsYW5SZXNwLmNob2ljZXNbMF0/Lm1lc3NhZ2U/LmNvbnRlbnQgPz8gXCJ7fVwiO1xuICAgIGNvbnN0IHBsYW4gPSBKU09OLnBhcnNlKHBsYW5SYXcpIGFzIHtcbiAgICAgIHNjZW5lOiBzdHJpbmc7XG4gICAgICBzdWJqZWN0OiBzdHJpbmc7XG4gICAgICBzZXR0aW5nOiBzdHJpbmc7XG4gICAgICBjb21wb3NpdGlvbjogc3RyaW5nO1xuICAgICAgbWVkaXVtOiBzdHJpbmc7XG4gICAgICByZWFsaXNtOiBzdHJpbmc7XG4gICAgICBsaWdodGluZzogc3RyaW5nO1xuICAgICAgcGFsZXR0ZTogc3RyaW5nO1xuICAgICAgc3R5bGVfbm90ZXM6IHN0cmluZztcbiAgICAgIG11c3RfaW5jbHVkZTogc3RyaW5nW107XG4gICAgICBhdm9pZDogc3RyaW5nW107XG4gICAgICByZW1peF9kaXJlY3RpdmU6IHN0cmluZztcbiAgICB9O1xuXG4gICAgLy8g4pyFIE5FVzogYmFrZSBpbiDigJxyZW1peCBwZXJtaXNzaW9u4oCdIGRpcmVjdGx5IGludG8gdGhlIGZpbmFsIHByb21wdFxuICAgIC8vIEFsc286IHNjYWxlIHRoZSBsYW5ndWFnZSBiYXNlZCBvbiByZW1peFN0cmVuZ3RoLlxuICAgIGNvbnN0IHJlbWl4TGluZSA9XG4gICAgICBzdHJlbmd0aCA+PSAwLjhcbiAgICAgICAgPyBcIkhpZ2hseSByZW1peGVkIHJlaW50ZXJwcmV0YXRpb24gd2l0aCBib2xkIHJlY29tcG9zaXRpb24gYW5kIHN1cnByaXNpbmcgZnVzaW9ucy5cIlxuICAgICAgICA6IHN0cmVuZ3RoID49IDAuNVxuICAgICAgICA/IFwiQ3JlYXRpdmUgcmVtaXggcmVpbnRlcnByZXRhdGlvbjsgYWxsb3cgcmVjb21wb3NpdGlvbiwgc2NhbGUgc2hpZnRzLCBhbmQgZnVzZWQgZWxlbWVudHMuXCJcbiAgICAgICAgOiBcIkxpZ2h0IHJlbWl4OyBzbWFsbCBidXQgbm90aWNlYWJsZSByZWFycmFuZ2VtZW50cyBhbmQgc3R5bGl6ZWQgaW50ZWdyYXRpb25zLlwiO1xuXG4gICAgY29uc3QgZmluYWxQcm9tcHQgPSBbXG4gICAgICAvLyBDb3JlXG4gICAgICBgJHtwbGFuLnNjZW5lfS4gJHtwbGFuLnN1YmplY3R9LiAke3BsYW4uc2V0dGluZ30uYCxcbiAgICAgIC8vIFJlbWl4IGRpcmVjdGl2ZSAoaW1wb3J0YW50IGZvciB0aGUgaW1hZ2UgbW9kZWwpXG4gICAgICByZW1peExpbmUsXG4gICAgICBwbGFuLnJlbWl4X2RpcmVjdGl2ZSA/IHBsYW4ucmVtaXhfZGlyZWN0aXZlIDogXCJcIixcbiAgICAgIC8vIFZpc3VhbCBjb250cm9sIChidXQgbm90IHRvbyByaWdpZClcbiAgICAgIGBDb21wb3NpdGlvbjogJHtwbGFuLmNvbXBvc2l0aW9ufS5gLFxuICAgICAgYE1lZGl1bTogJHtwbGFuLm1lZGl1bX0sIHJlYWxpc206ICR7cGxhbi5yZWFsaXNtfS5gLFxuICAgICAgYExpZ2h0aW5nOiAke3BsYW4ubGlnaHRpbmd9LiBQYWxldHRlOiAke3BsYW4ucGFsZXR0ZX0uYCxcbiAgICAgIHBsYW4uc3R5bGVfbm90ZXMgPyBgU3R5bGU6ICR7cGxhbi5zdHlsZV9ub3Rlc30uYCA6IFwiXCIsXG4gICAgICAvLyBBbmNob3JzXG4gICAgICBgTXVzdCBpbmNsdWRlIChpbnRlZ3JhdGVkIG5hdHVyYWxseSk6ICR7dW5pcShwbGFuLm11c3RfaW5jbHVkZSkuam9pbihcbiAgICAgICAgXCIsIFwiXG4gICAgICApfS5gLFxuICAgICAgcGxhbi5hdm9pZD8ubGVuZ3RoID8gYEF2b2lkOiAke3VuaXEocGxhbi5hdm9pZCkuam9pbihcIiwgXCIpfS5gIDogXCJcIixcbiAgICAgIC8vIFVuaXZlcnNhbCBjb25zdHJhaW50c1xuICAgICAgYE5vIHRleHQsIG5vIHdhdGVybWFyaywgbm8gVUksIG5vIGxvZ29zLCBubyBzaWduYXR1cmVzLmAsXG4gICAgICBgU3F1YXJlIGltYWdlLmAsXG4gICAgXVxuICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgLmpvaW4oXCIgXCIpO1xuXG4gICAgLy8gNCkgSW1hZ2UgcmVtaXggdXNpbmcgbXVsdGktaW1hZ2UgZWRpdHMgKGFycmF5IHN5bnRheClcbiAgICBjb25zdCBmb3JtID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgZm9ybS5hcHBlbmQoXCJtb2RlbFwiLCBcImdwdC1pbWFnZS0xLjVcIik7XG4gICAgZm9ybS5hcHBlbmQoXCJwcm9tcHRcIiwgZmluYWxQcm9tcHQpO1xuICAgIGZvcm0uYXBwZW5kKFwic2l6ZVwiLCBzaXplIHx8IFwiMTAyNHgxMDI0XCIpO1xuICAgIGZvcm0uYXBwZW5kKFwib3V0cHV0X2Zvcm1hdFwiLCBcInBuZ1wiKTtcblxuICAgIC8vIOKchSBrZWVwIG11bHRpLWltYWdlLCBidXQgYWxsb3cgYSBzb2Z0ZXIgaW5mbHVlbmNlIGJ5IG9yZGVyaW5nOlxuICAgIC8vIFB1dCB0aGUgXCJiYXNlXCIgZmlyc3Q7IG90aGVycyBmb2xsb3cuIChNYW55IG1vZGVscyBpbXBsaWNpdGx5IGJpYXMgZWFybGllciBpbnB1dHMuKVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW1hZ2VGaWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgZm9ybS5hcHBlbmQoXCJpbWFnZVtdXCIsIGltYWdlRmlsZXNbaV0pO1xuICAgIH1cblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKFwiaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MS9pbWFnZXMvZWRpdHNcIiwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Byb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZfWAsXG4gICAgICB9LFxuICAgICAgYm9keTogZm9ybSxcbiAgICB9KTtcblxuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCBlcnIgPSBhd2FpdCByZXMudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBPcGVuQUkgaW1hZ2UgZWRpdCBmYWlsZWQ6ICR7ZXJyfWApO1xuICAgIH1cblxuICAgIGNvbnN0IGltZyA9IGF3YWl0IHJlcy5qc29uKCk7XG5cbiAgICBjb25zdCBiNjQgPSBpbWcuZGF0YT8uWzBdPy5iNjRfanNvbjtcbiAgICBpZiAoIWI2NCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiBcIk5vIGltYWdlIHJldHVybmVkLlwiIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyA1KSBVcGxvYWQgcmVtaXggb3V0cHV0IHRvIENsb3VkaW5hcnlcbiAgICBjb25zdCByZW1peFVybCA9IGF3YWl0IHVwbG9hZEI2NFRvQ2xvdWRpbmFyeShiNjQpO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHJlbWl4ZWRQcm9tcHQ6IGZpbmFsUHJvbXB0LFxuICAgICAgcGxhbixcbiAgICAgIHJlbWl4U3RyZW5ndGg6IHN0cmVuZ3RoLFxuICAgICAgaW1hZ2VVcmw6IHJlbWl4VXJsLFxuICAgICAgcGFyZW50VXJsczogcGFyZW50cy5tYXAoKHApID0+IHAudXJsKSxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiUmVtaXggZXJyb3I6XCIsIGVycik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogXCJGYWlsZWQgdG8gcmVtaXggaW1hZ2VzXCIgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn1cblxuLyoqIC0tLS0tLS0tLS0gRXhpc3RpbmcgR0VUIChrZXB0IGZvciBjb21wYXRpYmlsaXR5KSAtLS0tLS0tLS0tICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbiAgICBjb25zdCBwcm9tcHQgPSB1cmwuc2VhcmNoUGFyYW1zLmdldChcInByb21wdFwiKSB8fCBcIlwiO1xuICAgIGNvbnN0IGFkamVjdGl2ZXMgPSB1cmwuc2VhcmNoUGFyYW1zLmdldChcImFkamVjdGl2ZXNcIikgfHwgXCJcIjtcblxuICAgIGNvbnN0IGNvbXBsZXRpb24gPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgbW9kZWw6IFwiZ3B0LTMuNS10dXJib1wiLFxuICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIGNvbnRlbnQ6XG4gICAgICAgICAgICBgcHJldGVuZCB0aGF0IHlvdSBhcmUgYW4gaW1hZ2UgcHJvbXB0IGVuZ2luZWVyIHRoYXQgaXMgdHJ5aW5nIHRvIHByb2R1Y2Ugc29jaWFsIG1lZGlhIGNvbnRlbnQuYCArXG4gICAgICAgICAgICBgV2UgbmVlZCB0byB3cml0ZSBhbiBpbWFnZSBwcm9tcHQgdGhhdCBleHBhbmRzIG9uIGFuZCBkZXBpY3RzIHRoZSBmb2xsb3dpbmcgc2VudGVuY2U6IFRoZXJlIGlzLi4uICR7cHJvbXB0fS4gYCArXG4gICAgICAgICAgICBgVGhlIGltYWdlIHNob3VsZCBmaXQgdGhpcyB2aWJlOiAke2FkamVjdGl2ZXN9IGFuZCBiZSBpbiB0aGUgc3R5bGUgb2YgbWVkaWF2YWwgZHJhd2luZ3Mgb3IgcG9zdC1pbnRlcm5ldCBncmFwaGljcyBhbmQgc2NpLWZpLCBgICtcbiAgICAgICAgICAgIGBwbGVhc2Ugb3V0cHV0IGFuIGltYWdlIHByb21wdCBpbiBlbmdsaXNoYCxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBtYXhfdG9rZW5zOiAxMDAsXG4gICAgfSk7XG5cbiAgICBjb25zdCBzZW50ZW5jZSA9IChjb21wbGV0aW9uLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50IHx8IFwiXCIpLnJlcGxhY2UoXG4gICAgICAnXCInLFxuICAgICAgXCJcIlxuICAgICk7XG5cbiAgICBjb25zdCBzdHlsZVN1ZmZpeCA9XG4gICAgICBcInRoZSBpbWFnZSBzaG91bGQgYmUgaW4gdGhlIHN0eWxlIG9mIG1pZGVhdmFsIGRyYXdpbmdzLCBmYW50YXN5LCBwb3N0LWludGVybmV0IGdyYXBoaWNzIGFuZCBzY2ktZmkuIHRoZSBpbWFnZSBpcyBub3QgYWxsb3dlZCB0byBzaG93IGFueSBjYXB0aW9uIG9yIFVJIGVsZW1lbnQuXCI7XG5cbiAgICBjb25zdCBpbWFnZSA9IGF3YWl0IG9wZW5haS5pbWFnZXMuZ2VuZXJhdGUoe1xuICAgICAgbW9kZWw6IFwiZGFsbC1lLTNcIixcbiAgICAgIHByb21wdDogYCR7c2VudGVuY2V9XFxuJHtzdHlsZVN1ZmZpeH1gLnRyaW0oKSxcbiAgICAgIG46IDEsXG4gICAgICBzaXplOiBcIjEwMjR4MTAyNFwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgIHByb21wdCxcbiAgICAgIHJlbWl4ZWRQcm9tcHQ6IHNlbnRlbmNlLFxuICAgICAgaW1hZ2VVcmw6IGltYWdlLmRhdGEgPyBpbWFnZS5kYXRhWzBdLnVybCA6IFwiaW1hZ2V1cmxwbGFjZWhvbGRlclwiLFxuICAgICAgdGFnczogYWRqZWN0aXZlcyxcbiAgICB9O1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGRhdGEpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJHZW5lcmF0aW9uIGVycm9yIChHRVQpOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogXCJGYWlsZWQgdG8gZ2VuZXJhdGUgY29udGVudFwiIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiT3BlbkFJIiwidjIiLCJjbG91ZGluYXJ5IiwicnVudGltZSIsIm9wZW5haSIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsImpvaW4iLCJhcnIiLCJzZXAiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJCb29sZWFuIiwibWFwIiwicyIsInRyaW0iLCJjb25maWciLCJjbG91ZF9uYW1lIiwiQ0xPVURJTkFSWV9DTE9VRF9OQU1FIiwiYXBpX2tleSIsIkNMT1VESU5BUllfQVBJX0tFWSIsImFwaV9zZWNyZXQiLCJDTE9VRElOQVJZX0FQSV9TRUNSRVQiLCJ1bmlxIiwiZnJvbSIsIlNldCIsImJ1aWxkQW5jaG9ycyIsImQiLCJvYmplY3RzIiwidmliZSIsInBlb3BsZSIsIm11c3RLZWVwIiwibXVzdF9rZWVwIiwiYW5jaG9ycyIsInNsaWNlIiwidXJsVG9GaWxlIiwidXJsIiwiZmFsbGJhY2tOYW1lIiwicmVzIiwiZmV0Y2giLCJvayIsIkVycm9yIiwic3RhdHVzIiwiY29udGVudFR5cGUiLCJoZWFkZXJzIiwiZ2V0IiwiZXh0IiwiaW5jbHVkZXMiLCJhYiIsImFycmF5QnVmZmVyIiwiYnVmIiwiQnVmZmVyIiwiRmlsZSIsInR5cGUiLCJ1cGxvYWRCNjRUb0Nsb3VkaW5hcnkiLCJiNjQiLCJmb2xkZXIiLCJkYXRhVXJpIiwidXBsb2FkZWQiLCJ1cGxvYWRlciIsInVwbG9hZCIsInJlc291cmNlX3R5cGUiLCJzZWN1cmVfdXJsIiwiUE9TVCIsInJlcXVlc3QiLCJib2R5IiwianNvbiIsImNvbnNvbGUiLCJsb2ciLCJwYXJlbnRzIiwiYWRqZWN0aXZlcyIsImNvbW11bml0aWVzIiwidHJlbmRzIiwiZXh0cmFQcm9tcHQiLCJzaXplIiwicmVtaXhTdHJlbmd0aCIsImFuY2hvclBlclBhcmVudCIsImxlbmd0aCIsImVycm9yIiwic3RyZW5ndGgiLCJNYXRoIiwibWF4IiwibWluIiwiaW1hZ2VGaWxlcyIsIlByb21pc2UiLCJhbGwiLCJwIiwiaSIsInBhcmVudFN1bW1hcmllcyIsImRlc2NyaXB0b3IiLCJpbmRleCIsInN1YmplY3QiLCJzZXR0aW5nIiwibWVkaXVtIiwicmVhbGlzbSIsImxpZ2h0aW5nIiwicGFsZXR0ZSIsImNvbXBvc2l0aW9uIiwidHJlbmQiLCJmZWVsaW5nIiwic3R5bGUiLCJzY2hlbWEiLCJuYW1lIiwic3RyaWN0IiwiYWRkaXRpb25hbFByb3BlcnRpZXMiLCJwcm9wZXJ0aWVzIiwic2NlbmUiLCJzdHlsZV9ub3RlcyIsIm11c3RfaW5jbHVkZSIsIml0ZW1zIiwibWluSXRlbXMiLCJtYXhJdGVtcyIsImF2b2lkIiwicmVtaXhfZGlyZWN0aXZlIiwicmVxdWlyZWQiLCJtZXJnZVByb21wdCIsIkpTT04iLCJzdHJpbmdpZnkiLCJwbGFuUmVzcCIsImNoYXQiLCJjb21wbGV0aW9ucyIsImNyZWF0ZSIsIm1vZGVsIiwidGVtcGVyYXR1cmUiLCJtYXhfdG9rZW5zIiwicmVzcG9uc2VfZm9ybWF0IiwianNvbl9zY2hlbWEiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwicGxhblJhdyIsImNob2ljZXMiLCJtZXNzYWdlIiwicGxhbiIsInBhcnNlIiwicmVtaXhMaW5lIiwiZmluYWxQcm9tcHQiLCJmb3JtIiwiRm9ybURhdGEiLCJhcHBlbmQiLCJtZXRob2QiLCJBdXRob3JpemF0aW9uIiwiZXJyIiwidGV4dCIsImltZyIsImRhdGEiLCJiNjRfanNvbiIsInJlbWl4VXJsIiwicmVtaXhlZFByb21wdCIsImltYWdlVXJsIiwicGFyZW50VXJscyIsIkdFVCIsIlVSTCIsInByb21wdCIsInNlYXJjaFBhcmFtcyIsImNvbXBsZXRpb24iLCJzZW50ZW5jZSIsInJlcGxhY2UiLCJzdHlsZVN1ZmZpeCIsImltYWdlIiwiaW1hZ2VzIiwiZ2VuZXJhdGUiLCJuIiwidGFncyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/generateImage/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/formdata-node","vendor-chunks/ms","vendor-chunks/core-js","vendor-chunks/lodash","vendor-chunks/openai","vendor-chunks/cloudinary","vendor-chunks/form-data-encoder","vendor-chunks/whatwg-url","vendor-chunks/agentkeepalive","vendor-chunks/tr46","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/webidl-conversions","vendor-chunks/q","vendor-chunks/humanize-ms","vendor-chunks/event-target-shim","vendor-chunks/cloudinary-core","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateImage%2Froute&page=%2Fapi%2FgenerateImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();